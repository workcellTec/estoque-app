<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Central Workcell</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000"/>
<link rel="apple-touch-icon" href="https://placehold.co/192x192/B71C1C/ffffff?text=CW">
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root {
--primary-color: #EF5350;
--primary-color-rgb: 239, 83, 80;
--tertiary-color: #030303;
--text-color: #F1F1F1;
--text-color-strong: #FFFFFF;
--text-secondary: #AAAAAA;
--text-success: #81C784;
--glass-bg: rgba(28, 28, 28, 0.65);
--glass-border: rgba(255, 255, 255, 0.1);
--shadow-color: rgba(0, 0, 0, 0.3);
--input-bg: rgba(44, 44, 46, 0.7);
--input-border: rgba(255, 255, 255, 0.1);
--border-radius: 16px;
--transition-duration: 0.3s;
--glow-1: #8A2BE2;
--glow-2: #B71C1C;
}
[data-theme="light"] {
--primary-color: #B71C1C;
--primary-color-rgb: 183, 28, 28;
--secondary-color: #f4f4f5;
--tertiary-color: #ffffff;
--text-color: #18181b;
--text-color-strong: #000000;
--text-secondary: #52525b;
--text-success: #16a34a;
--glass-bg: rgba(255, 255, 255, 0.75);
--glass-border: rgba(0, 0, 0, 0.1);
--shadow-color: rgba(183, 28, 28, 0.15);
--input-bg: #f4f4f5;
--input-border: #d4d4d8;
--glow-1: #D1C4E9;
--glow-2: #FFCDD2;
}
html { box-sizing: border-box; }
*, *:before, *:after { box-sizing: inherit; }
body {
font-family: 'Poppins', sans-serif;
background-color: var(--tertiary-color);
color: var(--text-color);
margin: 0; padding: 0;
width: 100%; overflow-x: hidden;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
transition: background-color var(--transition-duration), color var(--transition-duration);
position: relative;
}
body::before {
content: '';
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: -1;
background:
radial-gradient(circle at 20% 25%, var(--glow-1), transparent 40%),
radial-gradient(circle at 80% 75%, var(--glow-2), transparent 40%),
var(--tertiary-color);
background-size: 200% 200%;
opacity: 0.25;
animation: moveGlow 40s ease infinite;
will-change: background-position;
}
@keyframes moveGlow {
0% { background-position: 0% 50%; }
50% { background-position: 100% 50%; }
100% { background-position: 0% 50%; }
}
.container {
width: 100%; max-width: 550px; margin: 0 auto; padding: 20px 15px;
display: flex; flex-direction: column; align-items: center;
min-height: 100vh; justify-content: flex-start;
position: relative; z-index: 1;
will-change: transform, opacity;
}
h2, h3, h4, h5 { font-weight: 600; text-align: center; color: var(--text-color); }
.section-header { width: 100%; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--glass-border); }
.section-header h3 { margin-bottom: 0; font-size: 1.5rem; }
#mainMenu, #calculatorHome {
padding-top: 80px; justify-content: flex-start;
}
#mainMenu h2, #calculatorHome h2 {
text-shadow: 0 1px 3px rgba(0,0,0,0.3);
margin-bottom: 30px;
color: var(--text-color);
}
.btn-menu {
display: flex; align-items: center; justify-content: center; gap: 12px;
font-weight: 500; border-radius: var(--border-radius); padding: 16px 24px;
margin-bottom: 15px !important;
background-color: var(--glass-bg);
color: var(--text-color);
border: 1px solid var(--glass-border);
backdrop-filter: blur(5px);
-webkit-backdrop-filter: blur(5px);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
transition: all var(--transition-duration) ease;
width: 100%; max-width: 320px;
}
.btn-menu:hover {
background-color: rgba(255, 255, 255, 0.1);
transform: translateY(-3px) scale(1.02);
box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.45);
border-color: rgba(255, 255, 255, 0.2);
}
.content-card {
background-color: var(--glass-bg);
border-radius: var(--border-radius);
padding: 25px; margin-bottom: 20px; width: 100%;
border: 1px solid var(--glass-border);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
backdrop-filter: blur(5px);
-webkit-backdrop-filter: blur(5px);
transition: background-color var(--transition-duration) ease, border-color var(--transition-duration) ease;
}
.container:not(#mainMenu):not(#calculatorHome) {
padding-top: 20px; align-items: stretch;
}
.form-label { color: var(--text-secondary); margin-bottom: 8px; font-weight: 400; }
[data-theme="dark"] .form-label { color: var(--text-color); }
.form-control, .form-select {
background-color: var(--input-bg); color: var(--text-color);
border: 1px solid var(--input-border); border-radius: 12px !important;
padding: 12px 15px; transition: all var(--transition-duration) ease;
backdrop-filter: blur(2px);
}
.form-control::placeholder { color: var(--text-secondary); opacity: 0.7; }
.form-control:focus, .form-select:focus {
background-color: var(--input-bg); color: var(--text-color);
border-color: var(--primary-color);
box-shadow: 0 0 0 0.2rem rgba(var(--primary-color-rgb), 0.25), 0 0 10px rgba(var(--primary-color-rgb), 0.4);
outline: none;
}
.btn {
transition: all var(--transition-duration) ease; font-weight: 500;
border-radius: 12px; padding: 12px 20px;
display: inline-flex; align-items: center; justify-content: center; gap: 8px;
}
.btn-primary {
background: linear-gradient(135deg, #EF5350, #D32F2F);
color: #FFF;
border: none; box-shadow: 0 4px 12px var(--shadow-color);
}
.btn-primary:hover {
background: linear-gradient(135deg, #D32F2F, #B71C1C);
box-shadow: 0 6px 16px var(--shadow-color);
transform: translateY(-1px);
}
.btn-back { background: none; color: var(--text-secondary); border: none; font-size: 1.2rem; padding: 5px; }
.btn-back:hover { color: var(--text-color); }
.toggle-switch {
background-color: rgba(0,0,0,0.25);
border-radius: var(--border-radius);
padding: 4px;
display: flex;
justify-content: center;
border: 1px solid var(--input-border);
max-width: 400px;
margin: 0 auto 1.5rem auto;
position: relative;
}
.toggle-switch input[type="checkbox"] {
display: none;
}
.toggle-switch label {
width: 100%;
display: grid;
grid-template-columns: 1fr 1fr;
text-align: center;
position: relative;
cursor: pointer;
margin: 0;
color: var(--text-secondary);
}
.toggle-switch label span {
padding: 8px 15px;
border-radius: calc(var(--border-radius) - 4px);
transition: color var(--transition-duration);
z-index: 2;
display: flex;
align-items: center;
justify-content: center;
gap: 6px;
font-size: 0.9rem;
font-weight: 500;
}
.toggle-switch label::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 50%;
height: 100%;
background: var(--glass-bg);
border: 1px solid var(--glass-border);
box-shadow: 0 2px 8px rgba(0,0,0,0.2);
border-radius: calc(var(--border-radius) - 4px);
transition: transform var(--transition-duration) cubic-bezier(0.25, 0.46, 0.45, 0.94);
z-index: 1;
}
.toggle-switch input:checked + label::before {
transform: translateX(100%);
}
.toggle-switch input:not(:checked) + label span:first-of-type,
.toggle-switch input:checked + label span:last-of-type {
color: var(--text-color);
font-weight: 600;
}
.hidden { display: none !important; }
.custom-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1056; opacity: 0; visibility: hidden; transition: opacity var(--transition-duration) ease, visibility var(--transition-duration) ease; }
.custom-modal-overlay.active { opacity: 1; visibility: visible; }
.custom-modal-content { background-color: var(--secondary-color); color: var(--text-color); padding: 30px; border-radius: var(--border-radius); text-align: center; max-width: 400px; width: 90%; box-shadow: 0 10px 40px var(--shadow-color); transform: scale(0.9); transition: transform var(--transition-duration) ease; border: 1px solid var(--glass-border); }
.custom-modal-overlay.active .custom-modal-content { transform: scale(1); }
#toastNotification {
position: fixed;
top: -100px;
left: 50%;
transform: translateX(-50%);
background-color: var(--glass-bg);
color: var(--text-color);
padding: 12px 20px;
border-radius: var(--border-radius);
z-index: 10001;
border: 1px solid var(--glass-border);
backdrop-filter: blur(5px);
box-shadow: 0 4px 15px var(--shadow-color);
transition: top 0.4s ease-in-out, opacity 0.4s ease-in-out;
opacity: 0;
font-size: 0.9rem;
pointer-events: none;
}
#toastNotification.show {
top: 30px;
opacity: 1;
}
#contractContainer .content-card { max-width: 800px; margin: 0 auto; }
.form-section-title { color: var(--primary-color); border-bottom: 1px solid var(--glass-border); }
#contractPreview { position: absolute; left: -9999px; top: auto; font-family: 'Times New Roman', Times, serif; font-size: 12pt; line-height: 1.5; color: #000; background: #FFF; padding: 1cm; width: 21cm; box-sizing: border-box; }
#contractPreview h4 { font-size: 14pt; text-align: center; margin-bottom: 24pt; font-weight: bold; color: #000; }
#contractPreview p, #contractPreview div { margin-bottom: 12pt; text-align: justify; color: #000;}
#contractPreview .section-title { font-weight: bold; margin-bottom: 6pt; text-transform: uppercase; color: #000;}
#contractPreview .signature-line { border-bottom: 1px solid #000; width: 80%; margin: 40px auto 5px auto; }
#administracao { max-width: 900px; }
#administracao .admin-section { margin-bottom: 30px; padding: 25px; background-color: var(--glass-bg); border-radius: var(--border-radius); border: 1px solid var(--glass-border); backdrop-filter: blur(5px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
.user-id-display { position: fixed; bottom: 15px; left: 15px; background-color: var(--glass-bg); color: var(--text-secondary); padding: 8px 12px; border-radius: 8px; font-size: 0.8rem; z-index: 1000; backdrop-filter: blur(5px); border: 1px solid var(--glass-border); }
.spinner-border.text-primary { color: var(--primary-color) !important; }
.results-table { --bs-table-color: var(--text-color); --bs-table-bg: transparent; --bs-table-border-color: var(--glass-border); --bs-table-hover-bg: rgba(var(--primary-color-rgb), 0.1); --bs-table-hover-color: var(--text-color); }
.results-table thead th { color: var(--text-secondary); }
.results-table tbody tr.copyable-row { cursor: pointer; }
[data-theme="light"] .results-table { --bs-table-border-color: var(--input-border); }
.lucro-display { color: var(--text-success); }
@keyframes fadeInAndUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.content-card, .admin-section { animation: fadeInAndUp 0.5s ease-out forwards; }
.btn:active, .btn-menu:active { transform: scale(0.97); transition: transform 0.1s ease; }
.lucro-extra-valor { color: #0d6efd; font-weight: bold; text-shadow: 0 0 4px rgba(0, 217, 255, 0.7); }
[data-theme="light"] .lucro-extra-valor { color: #0056b3; text-shadow: none; }
.product-data-row.is-active { background-color: rgba(var(--primary-color-rgb), 0.1); }
.product-separator-row td { padding: 0 !important; border: none; text-align: center; }
.btn-toggle-menu { background: transparent; border: none; border-top: 1px dashed var(--glass-border); color: var(--text-secondary); cursor: pointer; padding: 4px; width: 100%; line-height: 1; }
.btn-toggle-menu i { transition: transform 0.3s ease; }
.product-separator-row.is-active .btn-toggle-menu i { transform: rotate(180deg); }
.acoes-produto { display: none; }
.acoes-produto.is-active { display: table-row; }
.acoes-produto td { padding: 0 1rem 1rem 1rem !important; border: none !important; background-color: transparent; }
.acoes-produto .action-menu-content { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
#productsTableBody .form-control { background-color: var(--input-bg) !important; border: 1px solid var(--input-border) !important; }
.extra-value-toggle { text-align: center; padding: 8px 0; margin: 8px auto; max-width: 400px; }
.btn-toggle-extra { background: none; border: none; border-top: 1px dashed rgba(var(--primary-color-rgb), 0.3); border-bottom: 1px dashed rgba(var(--primary-color-rgb), 0.3); color: var(--text-secondary); cursor: pointer; width: 100%; padding: 6px; opacity: 0.7; transition: opacity 0.3s ease; }
.btn-toggle-extra:hover { opacity: 1; }
.btn-toggle-extra i { transition: transform 0.3s ease; }
.btn-toggle-extra.is-active i { transform: rotate(180deg); }
.extra-value-container { max-height: 0; overflow: hidden; transition: max-height 0.35s ease-in-out, margin-top 0.35s ease-in-out; margin-top: 0; }
.extra-value-container.is-active { max-height: 100px; margin-top: 1rem; }
.favoritos { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 15px; }
.favorito { display: flex; align-items: center; background-color: var(--input-bg); border-radius: 20px; border: 1px solid var(--input-border); overflow: hidden; transition: all 0.2s ease; }
.favorito:hover { box-shadow: 0 0 8px rgba(var(--primary-color-rgb), 0.3); }
.favorito-btn { background: none; border: none; color: var(--text-color); padding: 6px 12px; cursor: pointer; transition: background-color 0.2s; font-size: 0.9rem; }
.favorito-btn:hover { background-color: rgba(var(--primary-color-rgb), 0.2); }
.remove-favorito-btn { color: var(--text-secondary); cursor: pointer; padding: 6px 10px; font-size: 0.9rem; border-left: 1px solid var(--input-border); transition: all 0.2s ease; }
.remove-favorito-btn:hover { color: #fff; background-color: rgba(220, 53, 69, 0.7); }
.btn-flag { display: flex; align-items: center; justify-content: flex-start; gap: 15px; font-weight: 500; font-size: 1.1rem; border-radius: 10px; padding: 15px 20px; border: 1px solid var(--glass-border); background-color: var(--input-bg); color: var(--text-color); transition: background-color var(--transition-duration) ease, transform var(--transition-duration) ease, border-color var(--transition-duration) ease; width: 100%; }
.btn-flag:hover { background-color: var(--primary-color); border-color: var(--primary-color); color: #FFF; transform: translateY(-2px); }
.btn-flag i { font-size: 1.5rem; width: 30px; }
.btn-flag-display { background-color: var(--input-bg); color: var(--text-color); border: 1px solid var(--input-border); border-radius: 10px !important; padding: 12px 15px; width: 100%; text-align: left; cursor: pointer; display: flex; align-items: center; gap: 8px; }
.btn-flag-display:hover { border-color: var(--primary-color); }
.btn-flag-display i { font-size: 1.2rem; }
.stock-qty-input { font-weight: bold; }
.stock-qty-input::-webkit-outer-spin-button, .stock-qty-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.stock-qty-input[type=number] { -moz-appearance: textfield; }
.product-colors-display { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
.color-swatch-sm { width: 12px; height: 12px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2); }
#reportPreview { display: none; font-family: Arial, sans-serif; color: #000; background: #FFF; }
#reportPreview h3 { color: #000; font-size: 16pt; text-align: center; font-weight: bold; margin-bottom: 5px;}
#reportPreview p { color: #555; font-size: 10pt; text-align: center; margin-bottom: 20px;}
#reportPreview table { width: 100%; border-collapse: collapse; margin-top: 20px; }
#reportPreview th, #reportPreview td { border: 1px solid #ccc; padding: 8px; text-align: left; color: #000;}
#reportPreview th { background-color: #f2f2f2; font-weight: bold; }
#colorPickerModalContent { max-width: 500px; }
#colorPickerProductName { font-weight: 600; color: var(--primary-color); }
.color-palette { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 10px; margin-top: 15px; padding: 15px; background-color: var(--input-bg); border-radius: 10px; max-height: 200px; overflow-y: auto; }
.color-swatch-lg { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border: 2px solid transparent; }
.color-swatch-lg:hover { transform: scale(1.1); }
.color-swatch-lg.selected { border-color: var(--primary-color); box-shadow: 0 0 10px var(--primary-color); }
#selectedColorsContainer { margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--glass-border); min-height: 50px; }
.selected-color-tag { display: inline-flex; align-items: center; gap: 6px; background-color: var(--input-bg); border-radius: 15px; padding: 5px 10px; margin: 3px; font-size: 0.9rem; }
.selected-color-tag .color-swatch-sm { border-color: rgba(0,0,0,0.2); }
.remove-color-btn { cursor: pointer; font-size: 1.1rem; line-height: 1; opacity: 0.7; }
.remove-color-btn:hover { opacity: 1; }
input[type="color"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; width: 40px; height: 40px; background-color: transparent; border: none; cursor: pointer; padding: 0; border-radius: 50%; overflow: hidden; }
input[type="color"]::-webkit-color-swatch { border-radius: 50%; border: 1px solid var(--input-border); }
input[type="color"]::-moz-color-swatch { border-radius: 50%; border: 1px solid var(--input-border); }
#installments1Value { color: var(--text-color-strong); }
.quick-installments {
display: flex;
gap: 10px;
justify-content: center;
margin-bottom: 10px;
flex-wrap: wrap;
}
.quick-installment-btn {
background-color: var(--input-bg);
color: var(--text-secondary);
border: 1px solid var(--input-border);
border-radius: 10px;
padding: 6px 12px;
font-size: 0.9rem;
cursor: pointer;
transition: all 0.2s ease;
}
.quick-installment-btn.active, .quick-installment-btn:hover {
background-color: var(--primary-color);
color: #fff;
border-color: var(--primary-color);
}
.history-accordion .accordion-item {
background-color: transparent;
border: 1px solid var(--glass-border);
border-radius: var(--border-radius);
margin-bottom: 15px;
overflow: hidden;
}
.history-accordion .accordion-header button {
background-color: var(--glass-bg);
backdrop-filter: blur(5px);
color: var(--text-color);
font-weight: 500;
border-radius: 0 !important;
box-shadow: none;
width: 100%;
text-align: left;
padding: 15px 20px;
border: none;
}
.history-accordion .accordion-header button:not(.collapsed) {
background-color: rgba(var(--primary-color-rgb), 0.1);
color: var(--primary-color);
}
.history-accordion .accordion-body {
padding: 20px;
background-color: rgba(0,0,0,0.1);
color: var(--text-secondary);
font-size: 0.9rem;
}
.history-accordion .accordion-body strong {
color: var(--text-color);
}
.history-accordion .accordion-collapse {
border-top: 1px solid var(--glass-border);
}
.history-accordion .accordion-button::after {
filter: brightness(0) invert(1);
opacity: 0.7;
}
[data-theme="light"] .history-accordion .accordion-button::after {
filter: none;
}
#top-right-controls {
position: fixed;
top: 20px;
right: 20px;
z-index: 9999;
display: flex;
flex-direction: column;
align-items: flex-end;
gap: 15px;
}
.toggle-switch-theme {
background-color: var(--input-bg);
border-radius: 20px;
padding: 2px;
display: flex;
border: 1px solid var(--input-border);
position: relative;
width: 60px;
height: 30px;
cursor: pointer;
}
.toggle-switch-theme input[type="checkbox"] { display: none; }
.toggle-switch-theme label {
width: 100%;
height: 100%;
display: grid;
grid-template-columns: 1fr 1fr;
align-items: center;
text-align: center;
position: relative;
cursor: pointer;
margin: 0;
color: var(--text-secondary);
}
.toggle-switch-theme label span {
z-index: 2;
font-size: 0.8rem;
}
.toggle-switch-theme label::before {
content: '';
position: absolute;
top: 2px;
left: 2px;
width: 24px;
height: 24px;
background: var(--glass-bg);
border: 1px solid var(--glass-border);
box-shadow: 0 1px 4px rgba(0,0,0,0.2);
border-radius: 50%;
transition: transform var(--transition-duration) cubic-bezier(0.25, 0.46, 0.45, 0.94);
z-index: 1;
}
.toggle-switch-theme input:checked + label::before {
transform: translateX(calc(100% + 2px));
}
.toggle-switch-theme input:not(:checked) + label span:first-of-type,
.toggle-switch-theme input:checked + label span:last-of-type {
color: var(--primary-color);
}
#notification-bell {
position: relative;
cursor: pointer;
background-color: var(--glass-bg);
backdrop-filter: blur(5px);
border: 1px solid var(--glass-border); color: var(--text-color);
width: 45px; height: 45px; border-radius: 50%; display: flex;
align-items: center; justify-content: center; font-size: 1.2rem;
transition: all var(--transition-duration); box-shadow: 0 4px 15px var(--shadow-color);
}
#notification-bell:hover { transform: scale(1.1); box-shadow: 0 6px 20px var(--shadow-color); }
.notification-badge {
position: absolute;
top: -2px; right: -2px;
width: 20px; height: 20px;
background-color: var(--primary-color);
color: white;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.7rem;
font-weight: 600;
border: 2px solid var(--tertiary-color);
}
.offcanvas {
background-color: var(--tertiary-color);
color: var(--text-color);
border-left: 1px solid var(--glass-border);
box-shadow: -10px 0 30px var(--shadow-color);
backdrop-filter: blur(10px);
background-color: var(--glass-bg);
}
.offcanvas-header {
border-bottom: 1px solid var(--glass-border);
}
.offcanvas-header .btn-close {
filter: invert(1) grayscale(1) brightness(2);
}
[data-theme="light"] .offcanvas-header .btn-close {
filter: none;
}
#notificationList .list-group-item {
background-color: transparent;
border-color: var(--glass-border);
color: var(--text-secondary);
cursor: pointer;
transition: background-color 0.2s ease;
}
#notificationList .list-group-item:hover {
background-color: rgba(var(--primary-color-rgb), 0.1);
}
#notificationList .list-group-item strong {
color: var(--text-color);
}
#stockContainer {
max-width: 100%;
padding-left: 8px;
padding-right: 8px;
}
.stock-list-container {
width: 100%;
}
.stock-item-card {
background-color: rgba(var(--primary-color-rgb), 0.05);
border: 1px solid var(--glass-border);
border-radius: var(--border-radius);
padding: 15px;
margin-bottom: 12px;
display: flex;
flex-direction: column;
gap: 12px;
transition: all var(--transition-duration) ease;
}
.stock-item-card.is-checked {
opacity: 0.6;
background-color: transparent;
}
.stock-item-main {
display: flex;
justify-content: space-between;
align-items: flex-start;
gap: 15px;
}
.product-info {
flex-grow: 1;
}
.product-name {
font-weight: 500;
color: var(--text-color-strong);
}
.stock-item-card:not(.is-checked) .product-name {
color: var(--primary-color);
}
.stock-item-main .form-check.form-switch .form-check-input {
width: 3.5em;
height: 1.75em;
cursor: pointer;
margin-left: auto;
}
.stock-item-controls {
display: flex;
justify-content: space-between;
align-items: center;
flex-wrap: wrap;
gap: 15px;
padding-top: 12px;
border-top: 1px solid var(--glass-border);
}
.ignore-toggle-btn i {
font-size: 1.2rem;
transition: color 0.2s ease;
}
.ignore-toggle-btn .bi-eye-fill {
color: var(--text-success);
}
.ignore-toggle-btn .bi-eye-slash-fill {
color: var(--primary-color);
}
/* NOVO DESIGN PARA ADMIN PRODUTOS */
#productsListContainer {
display: flex;
flex-direction: column;
gap: 15px;
}
.admin-product-card {
background-color: rgba(var(--primary-color-rgb), 0.05);
border: 1px solid var(--glass-border);
border-radius: var(--border-radius);
padding: 20px;
display: flex;
flex-direction: column;
gap: 15px;
}
.admin-product-card .form-group {
display: flex;
flex-direction: column;
gap: 5px;
}
.admin-product-card .form-label {
font-size: 0.8rem;
font-weight: 500;
color: var(--text-secondary);
margin-bottom: 0;
}
.admin-product-card .form-control,
.admin-product-card .form-select {
font-size: 0.95rem;
padding: 10px 12px;
}
.admin-product-card-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
}
.admin-product-card-grid .full-width {
grid-column: 1 / -1;
}
.admin-product-actions {
display: flex;
justify-content: space-between;
align-items: center;
padding-top: 15px;
margin-top: 10px;
border-top: 1px solid var(--glass-border);
}
@media (max-width: 480px) {
.admin-product-card-grid {
grid-template-columns: 1fr;
}
}
@media (max-width: 400px) {
.stock-item-controls {
flex-direction: column;
align-items: stretch;
}
.stock-item-controls .input-group {
width: 100%;
justify-content: center;
}
.stock-item-controls .d-flex {
width: 100%;
justify-content: space-around;
}
}
@media print {
html, body { background: #FFF !important; }
body::before { display: none !important; }
body > *:not(#contractPreview):not(#reportPreview) { display: none !important; }
#contractPreview, #reportPreview { display: block !important; position: static !important; margin: 0 auto; padding: 20mm; width: 210mm; min-height: 297mm; box-sizing: border-box; box-shadow: none; border: none; }
body.print-only-contract #reportPreview { display: none !important; }
body.print-only-report #contractPreview { display: none !important; }
}
</style>
</head>
<body>
<div id="loadingOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--tertiary-color); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease;">
<div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
<span class="visually-hidden">Loading...</span>
</div>
<p class="mt-3" style="color: var(--text-secondary);">Carregando sistema...</p>
</div>
<div id="top-right-controls" class="hidden">
<div class="toggle-switch-theme">
<input type="checkbox" id="theme-toggle-checkbox">
<label for="theme-toggle-checkbox">
<span><i class="bi bi-moon-fill"></i></span>
<span><i class="bi bi-sun-fill"></i></span>
</label>
</div>
<div id="notification-bell">
<i class="bi bi-bell-fill"></i>
<span class="notification-badge hidden"></span>
</div>
</div>
<div class="container text-center" id="mainMenu">
<h2 class="mb-4">Bem-vindo(a) à Central Workcell,<br/>O que você quer fazer?</h2>
<div class="d-grid gap-2">
<button class="btn-menu" id="goToCalculator"><i class="bi bi-calculator-fill"></i> Calculadora de Taxa</button>
<button class="btn-menu" id="goToContract"><i class="bi bi-file-earmark-text-fill"></i> Boletos</button>
<button class="btn-menu" id="goToStock"><i class="bi bi-box-seam"></i> Controle de Estoque</button>
<button class="btn-menu" id="goToAdmin"><i class="bi bi-gear"></i> Administração</button>
</div>
</div>
<div id="calculatorContainer" class="hidden">
<div class="container text-center" id="calculatorHome">
<h2 class="mb-4">Calculadora de Taxas,<br/>O que você quer fazer?</h2>
<div class="d-grid gap-2">
<button class="btn-menu" id="openFecharVenda"><i class="bi bi-cash-coin"></i> Fechar uma venda</button>
<button class="btn-menu" id="openRepassarValores"><i class="bi bi-arrow-left-right"></i> Repassar valores</button>
<button class="btn-menu" id="openCalcularEmprestimo"><i class="bi bi-bank"></i> Calcular Empréstimo</button>
<button class="btn-menu" id="openCalcularPorAparelho"><i class="bi bi-phone"></i> Calcular por aparelho</button>
</div>
</div>
<div class="container" id="fecharVenda" style="display: none;">
<div class="section-header">
<h3>Fechar Venda</h3>
<button aria-label="Voltar" class="btn-back" id="backFromFecharVenda"><i class="bi bi-arrow-left"></i></button>
</div>
<div class="content-card w-100">
<div class="row mb-3 w-100 justify-content-center">
<div class="col-12 col-md-4 mb-3"><label class="form-label">Maquininha</label><select class="form-select" id="machine1"><option value="pagbank">PagBank</option><option value="infinity" selected>InfinityPay</option><option value="valorante">Valorante</option></select></div>
<div class="col-12 col-md-4 mb-3" id="flagDisplayContainer1" style="display: none;"><label class="form-label">Bandeira</label><button class="btn-flag-display" id="flagDisplayButton1"></button></div>
<div class="col-12 col-md-4 mb-3">
<label for="installments1" class="form-label d-flex justify-content-between">
<span>Parcelas</span>
<span id="installments1Value" class="fw-bold">Débito</span>
</label>
<div id="quickInstallmentsContainer" class="quick-installments">
</div>
<input type="range" class="form-range" id="installments1" min="0" max="18" step="1" value="0">
</div>
</div>
<div id="brand1Container" class="hidden"><select id="brand1"><option value="visa">Visa</option><option value="mastercard">Mastercard</option><option value="hiper">Hiper</option><option value="hipercard">Hipercard</option><option value="elo">Elo</option><option value="amex">Amex</option></select></div>
<div class="toggle-switch">
<input type="checkbox" id="vendaModeToggle">
<label for="vendaModeToggle">
<span><i class="bi bi-pencil-alt"></i> Entrada Manual</span>
<span><i class="bi bi-box-seam"></i> Venda por Produto</span>
</label>
</div>
<div class="mb-3 d-flex justify-content-center flex-wrap" id="manualModeContainer">
<label class="me-3"><input checked="" name="manualMode" type="radio" value="total"/> Valor Total</label>
<label><input name="manualMode" type="radio" value="parcela"/> Valor da Parcela</label>
</div>
<div class="w-100 hidden" id="vendaPorProdutoContainer" style="max-width: 400px; margin: 0 auto;">
<div class="mb-3 search-wrapper">
<label class="form-label" for="vendaProdutoSearch"><i class="bi bi-search"></i> Pesquisar Produto</label>
<input autocomplete="off" class="form-control" id="vendaProdutoSearch" placeholder="Carregando..." type="text"/>
<div class="search-results-container list-group" id="vendaSearchResultsContainer"></div>
</div>
<div class="mb-3"><label class="form-label" for="fecharVendaPrecoBase"><i class="bi bi-tag"></i> Preço Base (R$)</label><input class="form-control" id="fecharVendaPrecoBase" readonly="" type="text"/></div>
<div class="form-check form-switch my-3 hidden" id="entradaAVistaToggleContainer">
<input class="form-check-input" type="checkbox" role="switch" id="entradaAVistaCheckbox">
<label class="form-check-label" for="entradaAVistaCheckbox">Entrada à vista?</label>
</div>
<div id="entradaAVistaContainer" class="hidden">
<div class="mb-3">
<label class="form-label" for="valorEntradaAVista"><i class="bi bi-cash"></i> Valor da entrada (à vista, sem taxa)</label>
<input class="form-control" id="valorEntradaAVista" type="number" step="0.01" min="0" placeholder="Ex: 500,00">
</div>
<div class="mb-3">
<label class="form-label" for="valorPassadoNoCartao"><i class="bi bi-credit-card"></i> Valor passado no cartão (com taxa)</label>
<input class="form-control" id="valorPassadoNoCartao" type="number" step="0.01" min="0" placeholder="Ex: 1849,00">
</div>
</div>
</div>
<div class="w-100 d-flex justify-content-center" id="fecharVendaInputs">
<div class="mb-3" style="width: 100%; max-width: 400px;"><label class="form-label" for="fecharVendaValue" id="fecharVendaValueLabel"><i class="bi bi-currency-dollar"></i> Valor Total da Venda (R$)</label><input class="form-control form-control-lg" id="fecharVendaValue" min="0" placeholder="Digite o valor" step="0.01" type="number"/></div>
</div>
<div class="w-100 d-flex flex-column justify-content-center mt-3" id="resultFecharVenda"></div>
</div>
</div>
<div class="container" id="repassarValores" style="display: none;">
<div class="section-header">
<h3>Repassar Valores</h3>
<button aria-label="Voltar" class="btn-back" id="backFromRepassarValores"><i class="bi bi-arrow-left"></i></button>
</div>
<div class="content-card w-100">
<div class="row mb-3 w-100 justify-content-center">
<div class="col-12 col-md-6 mb-3"><label class="form-label">Maquininha</label><select class="form-select" id="machine2"><option value="pagbank">PagBank</option><option value="infinity">InfinityPay</option><option value="valorante">Valorante</option></select></div>
<div class="col-12 col-md-6 mb-3" id="flagDisplayContainer2" style="display: none;"><label class="form-label">Bandeira</label><button class="btn-flag-display" id="flagDisplayButton2"></button></div>
</div>
<div id="brand2Container" class="hidden"><select id="brand2"><option value="visa">Visa</option><option value="mastercard">Mastercard</option><option value="hiper">Hiper</option><option value="hipercard">Hipercard</option><option value="elo">Elo</option><option value="amex">Amex</option></select></div>
<div class="mb-3" style="max-width: 400px; margin: 0 auto 1rem;">
<label class="form-label" for="repassarValue"><i class="bi bi-calculator"></i> Valor Desejado (líquido)</label>
<input class="form-control form-control-lg" id="repassarValue" min="0" placeholder="Digite o valor desejado" step="0.01" type="number"/>
</div>
<div class="w-100 d-flex flex-column align-items-center" id="resultRepassarValores"></div>
<div class="text-center mt-3 w-100" id="exportRepassarContainer" style="display: none;">
<button class="btn btn-info" id="exportRepassarBtn"><i class="bi bi-camera-fill"></i> Exportar Imagem</button>
</div>
</div>
</div>
<div class="container" id="calcularEmprestimo" style="display: none;">
<div class="section-header">
<h3>Calcular Empréstimo</h3>
<button aria-label="Voltar" class="btn-back" id="backFromCalcularEmprestimo"><i class="bi bi-arrow-left"></i></button>
</div>
<div class="content-card w-100">
<div class="d-flex justify-content-between align-items-center mb-3">
<div class="lucro-display" id="emprestimoLucroDisplay"></div>
<button id="openLucroModalBtn" class="btn btn-sm btn-back" aria-label="Configurar Lucro" style="font-size: 1.4rem;"><i class="bi bi-gear-fill"></i></button>
</div>
<div id="valorLiquidoDisplay" class="mb-3"></div>
<div class="mb-3" style="max-width: 400px; margin: 0 auto 1rem;">
<label class="form-label" for="emprestimoValue"><i class="bi bi-cash-coin"></i> Valor Base do Empréstimo</label>
<input class="form-control form-control-lg" id="emprestimoValue" min="0" placeholder="Ex: 10000" step="0.01" type="number"/>
</div>
<div class="row mb-3 w-100 justify-content-center">
<div class="col-12 col-md-6 mb-3"><label class="form-label">Maquininha</label><select class="form-select" id="machine4"><option value="pagbank">PagBank</option><option value="infinity">InfinityPay</option><option value="valorante" selected>Valorante</option></select></div>
<div class="col-12 col-md-6 mb-3" id="flagDisplayContainer4" style="display: none;"><label class="form-label">Bandeira</label><button class="btn-flag-display" id="flagDisplayButton4"></button></div>
</div>
<div id="brand4Container" class="hidden"><select id="brand4"><option value="visa">Visa</option><option value="mastercard">Mastercard</option><option value="hiper">Hiper</option><option value="hipercard">Hipercard</option><option value="elo">Elo</option><option value="amex">Amex</option></select></div>
<div class="w-100 d-flex flex-column align-items-center" id="resultCalcularEmprestimo"></div>
<div class="text-center mt-3 w-100" id="exportEmprestimoContainer" style="display: none;">
<button class="btn btn-info" id="exportEmprestimoBtn"><i class="bi bi-camera-fill"></i> Exportar Imagem</button>
</div>
</div>
</div>
<div class="container" id="calcularPorAparelho" style="display: none;">
<div class="section-header">
<h3>Calcular por Aparelho</h3>
<button aria-label="Voltar" class="btn-back" id="backFromCalcularPorAparelho"><i class="bi bi-arrow-left"></i></button>
</div>
<div class="content-card w-100">
<div id="aparelhoContentWrapper">
<div class="favoritos" id="aparelhoFavoritosContainer"></div>
<div class="mb-3 search-wrapper mx-auto"><label class="form-label" for="aparelhoSearch"><i class="bi bi-search"></i> Pesquisar Aparelho</label><input autocomplete="off" class="form-control" id="aparelhoSearch" placeholder="Carregando..." type="text"/><div class="search-results-container list-group" id="aparelhoResultsContainer"></div></div>
<div id="aparelhoInfoNote" class="text-center text-secondary small my-2 hidden" style="max-width: 400px; margin-left: auto; margin-right: auto; padding: 8px; background-color: var(--input-bg); border-radius: 8px;"></div>
<div class="mb-3 mx-auto" style="max-width: 400px;">
<label class="form-label" for="entradaAparelho"><i class="bi bi-wallet2"></i> Valor de entrada (opcional)</label>
<input class="form-control" id="entradaAparelho" min="0" placeholder="Digite o valor da entrada" step="0.01" type="number"/>
</div>
<div class="extra-value-toggle mx-auto">
<button class="btn-toggle-extra" id="toggleValorExtraBtn" aria-label="Adicionar valor extra">
<i class="bi bi-chevron-down"></i>
</button>
</div>
<div class="extra-value-container mx-auto" id="valorExtraContainer" style="max-width: 400px;">
<div class="mb-3">
<label class="form-label" for="valorExtraAparelho"><i class="bi bi-plus-circle"></i> Valor adicional</label>
<input class="form-control" id="valorExtraAparelho" min="0" placeholder="Ex: 40,00" step="0.01" type="number"/>
</div>
</div>
<div class="text-center mt-3">
<button class="btn btn-sm hidden" id="saveAparelhoFavoriteBtn" style="background-color: rgba(var(--primary-color-rgb), 0.15); color: var(--primary-color);">
<i class="bi bi-star-fill"></i> Salvar como favorito
</button>
</div>
<div class="row my-3 w-100 justify-content-center">
<div class="col-12 col-md-6 mb-3"><label class="form-label">Maquininha</label><select class="form-select" id="machine3"><option value="pagbank">PagBank</option><option value="infinity">InfinityPay</option><option value="valorante">Valorante</option></select></div>
<div class="col-12 col-md-6 mb-3" id="flagDisplayContainer3" style="display: none;"><label class="form-label">Bandeira</label><button class="btn-flag-display" id="flagDisplayButton3"></button></div>
</div>
<div id="brand3Container" class="hidden"><select id="brand3"><option value="visa">Visa</option><option value="mastercard">Mastercard</option><option value="hiper">Hiper</option><option value="hipercard">Hipercard</option><option value="elo">Elo</option><option value="amex">Amex</option></select></div>
<div class="w-100 d-flex flex-column align-items-center" id="resultCalcularPorAparelho"></div>
<div class="text-center mt-3 w-100" id="exportAparelhoContainer" style="display: none;">
<button class="btn btn-info" id="exportAparelhoBtn"><i class="bi bi-camera-fill"></i> Exportar Imagem</button>
</div>
</div>
<div id="aparelhoEmptyStateWrapper" class="hidden text-center" style="padding: 2rem 0;">
<i class="bi bi-box2-heart" style="font-size: 4rem; color: var(--primary-color);"></i>
<h4 class="mt-4">A sua lista de produtos está vazia</h4>
<p class="text-secondary">
Vá à secção de <strong style="color: var(--text-color);">Administração</strong> para adicionar os seus produtos.
</p>
<button class="btn btn-primary mt-3" id="goToAdminFromEmptyState">
<i class="bi bi-gear"></i> Ir para Administração
</button>
</div>
</div>
</div>
</div>
<div class="container" id="administracao" style="display: none;">
<div class="section-header">
<h3>Administração</h3>
<button aria-label="Voltar" class="btn-back" id="backFromAdmin"><i class="bi bi-arrow-left"></i></button>
</div>
<div class="admin-section w-100">
<h5 class="text-center mb-3">Selecione o que deseja gerenciar</h5>
<div class="btn-group w-100 mb-3" id="admin-nav-buttons" role="group">
<button type="button" class="btn btn-outline-secondary active" data-admin-section="adminProductsContent">Produtos</button>
<button type="button" class="btn btn-outline-secondary" data-admin-section="adminRatesContent">Taxas</button>
<button type="button" class="btn btn-outline-secondary" data-admin-section="adminTagsContent">Etiquetas</button>
</div>
</div>
<div id="adminProductsContent">
<div class="admin-section text-start w-100">
<h4 class="mb-3"><i class="bi bi-plus-circle-fill"></i> Adicionar Novo Produto</h4>
<form id="addProductForm">
<div class="mb-3">
<label for="newProductName" class="form-label">Nome do Produto</label>
<input type="text" class="form-control" id="newProductName" required>
</div>
<div class="mb-3">
<label for="newProductValue" class="form-label">Valor (R$)</label>
<input type="text" class="form-control" id="newProductValue" required placeholder="Ex: 2499,90">
</div>
<div class="row">
<div class="col-md-6 mb-3">
<label for="newProductTag" class="form-label">Etiqueta</label>
<select class="form-select" id="newProductTag" required>
</select>
</div>
<div class="col-md-6 mb-3">
<label for="newProductQuantity" class="form-label">Quantidade (Opcional)</label>
<input type="number" class="form-control" id="newProductQuantity" placeholder="1" min="0">
</div>
<div class="col-md-12 mb-3">
<label for="newProductColors" class="form-label">Cores (Separadas por vírgula)</label>
<input type="text" class="form-control" id="newProductColors" placeholder="Azul, Preto...">
</div>
</div>
<button type="submit" class="btn btn-success w-100"><i class="bi bi-plus-lg"></i> Adicionar Produto</button>
</form>
</div>
<div class="admin-section text-start w-100">
<div class="d-flex justify-content-between align-items-center mb-3">
<h4 class="mb-0"><i class="bi bi-list-ul"></i> Produtos</h4>
<input class="form-control" id="adminSearchInput" placeholder="Filtrar..." style="width: 200px;" type="text">
</div>
<div id="productsListContainer">
</div>
</div>
<div class="admin-section text-center w-100 pt-3">
<button class="btn btn-danger" id="deleteAllProductsBtn"><i class="bi bi-trash-fill"></i> Excluir todos os produtos</button>
</div>
</div>
<div id="adminRatesContent" class="hidden">
<div class="admin-section">
<h4 class="text-start"><i class="bi bi-eye-fill"></i> Maquininhas Visíveis</h4>
<p class="text-start text-secondary">Desative as maquininhas que você não utiliza para simplificar as telas de cálculo.</p>
<div id="machineVisibilityToggles">
<div class="form-check form-switch mb-2">
<input class="form-check-input visibility-toggle" type="checkbox" role="switch" id="toggle-pagbank-visibility" data-machine="pagbank" checked>
<label class="form-check-label" for="toggle-pagbank-visibility">PagBank</label>
</div>
<div class="form-check form-switch mb-2">
<input class="form-check-input visibility-toggle" type="checkbox" role="switch" id="toggle-infinity-visibility" data-machine="infinity" checked>
<label class="form-check-label" for="toggle-infinity-visibility">InfinityPay</label>
</div>
<div class="form-check form-switch">
<input class="form-check-input visibility-toggle" type="checkbox" role="switch" id="toggle-valorante-visibility" data-machine="valorante" checked>
<label class="form-check-label" for="toggle-valorante-visibility">Valorante</label>
</div>
</div>
</div>
<div class="admin-section">
<h4 class="text-start"><i class="bi bi-pencil-square"></i> Editar Taxas do Sistema</h4>
<p class="text-start text-secondary">Altere os valores e clique em salvar. As mudanças serão aplicadas para todos os usuários.</p>
<div class="accordion" id="ratesAccordion">
<div class="text-center p-4">
<div class="spinner-border text-primary" role="status">
<span class="visually-hidden">Carregando...</span>
</div>
</div>
</div>
<button class="btn btn-primary w-100 mt-4" id="saveRatesBtn">
<i class="bi bi-save-fill"></i> Salvar Alterações de Taxas
</button>
</div>
</div>
<div id="adminTagsContent" class="hidden">
</div>
</div>
<div id="contractContainer" class="container hidden">
<div class="section-header">
<h3>Boletos</h3>
<button aria-label="Voltar" class="btn-back" id="backFromContract"><i class="bi bi-arrow-left"></i></button>
</div>
<div class="toggle-switch">
<input type="checkbox" id="boletoModeToggle">
<label for="boletoModeToggle">
<span><i class="bi bi-file-earmark-plus-fill"></i> Novo Formulário</span>
<span><i class="bi bi-clock-history"></i> Histórico</span>
</label>
</div>
<div id="newBoletoContent">
<div class="content-card w-100">
<form id="contractForm">
<h5 class="form-section-title">Dados do Comprador</h5>
<div class="row">
<div class="col-md-12 mb-3">
<label for="compradorNome" class="form-label">Nome Completo</label>
<input type="text" class="form-control" id="compradorNome" required>
</div>
<div class="col-md-6 mb-3">
<label for="compradorCpf" class="form-label">CPF</label>
<input type="text" class="form-control" id="compradorCpf" required>
</div>
<div class="col-md-6 mb-3">
<label for="compradorRg" class="form-label">RG</label>
<input type="text" class="form-control" id="compradorRg">
</div>
<div class="col-md-6 mb-3">
<label for="compradorTelefone" class="form-label">Telefone (WhatsApp)</label>
<input type="tel" class="form-control" id="compradorTelefone" placeholder="(XX) XXXXX-XXXX">
</div>
<div class="col-md-6 mb-3">
<label for="compradorEndereco" class="form-label">Endereço Completo</label>
<input type="text" class="form-control" id="compradorEndereco" required>
</div>
</div>
<h5 class="form-section-title">Dados do Produto</h5>
<div class="row">
<div class="col-md-12 mb-3">
<label for="produtoModelo" class="form-label">Modelo(s) do Smartphone</label>
<input type="text" class="form-control" id="produtoModelo" required>
</div>
<div class="col-md-12 mb-3">
<label for="produtoImei" class="form-label">IMEI(s)</label>
<input type="text" class="form-control" id="produtoImei" required>
</div>
</div>
<h5 class="form-section-title">Condições de Pagamento</h5>
<div class="row">
<div class="col-md-6 mb-3">
<label for="valorTotal" class="form-label">Valor Total (R$)</label>
<input type="number" step="0.01" class="form-control" id="valorTotal" required>
</div>
<div class="col-md-6 mb-3">
<label for="valorEntrada" class="form-label">Valor da Entrada (R$)</label>
<input type="number" step="0.01" class="form-control" id="valorEntrada" required>
</div>
<div class="col-md-6 mb-3">
<label for="numeroParcelas" class="form-label">Nº de Parcelas</label>
<input type="number" step="1" class="form-control" id="numeroParcelas" required>
</div>
<div class="col-md-6 mb-3">
<label for="tipoParcela" class="form-label">Frequência</label>
<select class="form-select" id="tipoParcela">
<option value="mensais" selected>Mensais</option>
<option value="semanais">Semanais</option>
</select>
</div>
<div class="col-md-6 mb-3">
<label for="primeiroVencimento" class="form-label">Dia do 1º Vencimento <span style="color: var(--primary-color); font-size: 0.8em;">(Opcional)</span></label>
<input type="date" class="form-control" id="primeiroVencimento">
</div>
<div class="col-md-6 mb-3">
<label for="valorParcela" class="form-label">Valor da Parcela (R$)</label>
<input type="text" class="form-control" id="valorParcela" readonly>
</div>
<div class="col-12">
<label for="saldoRestante" class="form-label">Saldo Restante (R$)</label>
<input type="text" class="form-control" id="saldoRestante" readonly>
</div>
</div>
<div class="text-center mt-4 d-flex justify-content-center gap-2 flex-wrap">
<button type="button" id="btnImprimir" class="btn btn-primary"><i class='bi bi-printer'></i> Imprimir e Salvar</button>
<button type="button" id="btnLimparCampos" class="btn btn-secondary"><i class='bi bi-eraser'></i> Limpar Campos</button>
<button type="button" id="btnApagarRascunho" class="btn btn-outline-danger"><i class='bi bi-trash'></i> Apagar Rascunho</button>
</div>
<div id="draftStatus" class="text-secondary small mt-2 text-center" style="height: 1.2em;"></div>
</form>
</div>
</div>
<div id="historyBoletoContent" class="hidden w-100">
</div>
</div>
<div id="stockContainer" class="container hidden">
<div class="section-header">
<h3>Controle de Estoque</h3>
<button aria-label="Voltar" class="btn-back" id="backFromStock"><i class="bi bi-arrow-left"></i></button>
</div>
<div class="content-card w-100">
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
<input class="form-control" id="stockSearchInput" placeholder="Filtrar produtos..." style="flex: 1; min-width: 180px;" type="text">
<div class="btn-group">
<button class="btn btn-outline-secondary btn-sm" id="toggleIgnoredBtn" title="Mostrar produtos ignorados"><i class="bi bi-eye-slash-fill"></i></button>
<button class="btn btn-outline-danger btn-sm" id="resetCountBtn" title="Resetar Contagem"><i class="bi bi-arrow-counterclockwise"></i></button>
<button class="btn btn-info btn-sm" id="generateReportBtn"><i class="bi bi-printer"></i> Relatório</button>
</div>
</div>
<div class="stock-list-container" id="stockTableBody">
</div>
</div>
</div>
<div id="contractPreview">
</div>
<div id="reportPreview"></div>
<div class="user-id-display" id="userIdDisplay" style="display: none;"></div>
<div class="custom-modal-overlay" id="customModalOverlay">
<div class="custom-modal-content">
<h4 id="customModalMessage"></h4>
<input class="hidden form-control" id="customModalPasswordInput" placeholder="Digite a senha" type="password"/>
<div id="customModalButtons" class="mt-3">
<button class="btn btn-primary btn-ok">OK</button>
<button class="btn btn-secondary btn-cancel">Cancelar</button>
</div>
</div>
</div>
<div id="toastNotification"></div>
<div class="custom-modal-overlay" id="lucroModalOverlay">
<div class="custom-modal-content">
<h4>Alterar Lucro (%)</h4>
<input class="form-control mt-3" id="lucroPercentInput" type="number" step="1" min="0" placeholder="Ex: 15"/>
<div class="mt-3">
<button class="btn btn-primary" id="saveLucroBtn">Salvar</button>
<button class="btn btn-secondary" id="cancelLucroBtn">Cancelar</button>
</div>
</div>
</div>
<div class="custom-modal-overlay" id="favoriteNameModalOverlay">
<div class="custom-modal-content">
<h4>Salvar Favorito</h4>
<p class="text-secondary small mb-3">Digite um nome para esta configuração.</p>
<input class="form-control" id="favoriteNameInput" placeholder="Ex: iPhone com entrada" type="text"/>
<div class="mt-3">
<button class="btn btn-primary" id="confirmSaveFavoriteBtn">Salvar</button>
<button class="btn btn-secondary" id="cancelSaveFavoriteBtn">Cancelar</button>
</div>
</div>
</div>
<div class="custom-modal-overlay" id="flagSelectorModalOverlay">
<div class="custom-modal-content" id="flagSelectorModalContent">
<div class="d-flex justify-content-between align-items-center mb-3">
<h4 id="flagSelectorTitle" class="mb-0">Selecione a Bandeira</h4>
<button aria-label="Fechar" class="btn-back" id="closeFlagModalBtn"><i class="bi bi-x-lg"></i></button>
</div>
<div class="d-grid gap-2" id="flagSelectorButtons"></div>
</div>
</div>
<div class="custom-modal-overlay" id="colorPickerModalOverlay">
<div class="custom-modal-content" id="colorPickerModalContent">
<h5 class="mb-1">Editar Cores</h5>
<p id="colorPickerProductName" class="text-secondary mb-3"></p>
<div id="colorPalette" class="color-palette"></div>
<div id="selectedColorsContainer">
<p class="text-start text-secondary small mb-2">Cores Selecionadas:</p>
<div id="selectedColors" class="d-flex flex-wrap gap-2"></div>
</div>
<div class="mt-3 pt-3 border-top border-secondary border-opacity-25">
<p class="text-start text-secondary small mb-2">Adicionar Cor Personalizada:</p>
<div class="d-flex gap-2 align-items-center">
<input type="text" class="form-control form-control-sm" id="customColorNameInput" placeholder="Nome da Cor">
<input type="color" id="customColorHexInput" value="#CCCCCC" title="Selecione a cor">
<button class="btn btn-sm btn-success" id="addCustomColorBtn">Add</button>
</div>
</div>
<div class="mt-4 d-flex justify-content-end gap-2">
<button class="btn btn-secondary" id="cancelColorPicker">Cancelar</button>
<button class="btn btn-primary" id="saveColorPicker">Salvar</button>
</div>
</div>
</div>
<div class="offcanvas offcanvas-end" tabindex="-1" id="notificationPanel" aria-labelledby="notificationPanelLabel">
<div class="offcanvas-header">
<h5 class="offcanvas-title" id="notificationPanelLabel"><i class="bi bi-bell-fill me-2"></i>Notificações</h5>
<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
</div>
<div class="offcanvas-body">
<div id="notificationList" class="list-group list-group-flush">
</div>
</div>
</div>
<script type="application/json" id="manifest-data">
{
"name": "Centrar Workcell",
"short_name": "CentrarWorkcell",
"description": "Calculadora de taxas e gerador de contratos para facilitar suas vendas.",
"start_url": ".",
"display": "standalone",
"background_color": "#000000",
"theme_color": "#B71C1C",
"orientation": "portrait-primary",
"icons": [
{ "src": "https://placehold.co/192x192/B71C1C/ffffff?text=CW", "type": "image/png", "sizes": "192x192" },
{ "src": "https://placehold.co/512x512/B71C1C/ffffff?text=CW", "type": "image/png", "sizes": "512x512" }
]
}
</script>
<script type="text/plain" id="sw-script">
const CACHE_NAME = 'centrar-workcell-cache-v1';
const urlsToCache = [ '/', '/index.html', 'https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap', 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css', 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css', 'https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js', 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js', 'https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js', 'https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js', 'https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js' ];
self.addEventListener('install', event => { event.waitUntil( caches.open(CACHE_NAME).then(cache => { console.log('Cache aberto'); return cache.addAll(urlsToCache); }) ); });
self.addEventListener('fetch', event => { event.respondWith( caches.match(event.request).then(response => { if (response) { return response; } return fetch(event.request).then( response => { if(!response || response.status !== 200 || response.type !== 'basic') { return response; } const responseToCache = response.clone(); caches.open(CACHE_NAME).then(cache => { cache.put(event.request, responseToCache); }); return response; } ); }) ); });
self.addEventListener('activate', event => { const cacheWhitelist = [CACHE_NAME]; event.waitUntil( caches.keys().then(cacheNames => { return Promise.all( cacheNames.map(cacheName => { if (cacheWhitelist.indexOf(cacheName) === -1) { return caches.delete(cacheName); } }) ); }) ); });
</script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
import { getDatabase, ref, push, update, remove, onValue, off } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
const firebaseConfig = {
apiKey: "AIzaSyANdJzvmHr8JVqrjveXbP_ZV6ZRR6fcVQk",
authDomain: "ctwbybrendon.firebaseapp.com",
databaseURL: "https://ctwbybrendon-default-rtdb.firebaseio.com",
projectId: "ctwbybrendon",
storageBucket: "ctwbybrendon.firebasestorage.app",
messagingSenderId: "37459949616",
appId: "1:37459949616:web:bf2e722a491f45880a55f5"
};
let app, db, auth, userId = null, isAuthReady = false, areRatesLoaded = false;
let products = [], fuse, selectedAparelhoValue = 0, fecharVendaPrecoBase = 0;
let currentCalculatorSectionId = 'calculatorHome', productsListener = null, rates = {};
let boletosListener = null;
let notificationsListener = null;
let currentMainSectionId = 'main';
let emprestimoLucroPercentual = 15;
let onlyShowIgnored = false;
let checkedItems = {};
let modificationTracker = {};
let tagTexts = {};
let tags = [];
let tagsListener = null;
let currentlySelectedProductForCalc = null;
const APARELHO_FAVORITES_KEY = 'ctwAparelhoFavoritos';
const CHECKED_ITEMS_KEY = 'ctwCheckedItems';
const MAX_FAVORITES = 5;
const CONTRACT_DRAFT_KEY = 'ctwContractDraft';
const TAG_TEXTS_KEY = 'ctwTagTexts';
let draftSaveTimeout;
const safeStorage = {
getItem(key) { try { return localStorage.getItem(key); } catch (e) { console.warn("Acesso ao localStorage negado.", e); return null; } },
setItem(key, value) { try { localStorage.setItem(key, value); } catch (e) { console.warn("Acesso ao localStorage negado.", e); } },
removeItem(key) { try { localStorage.removeItem(key); } catch (e) { console.warn("Acesso ao localStorage negado.", e); } }
};
const themeToggleCheckbox = document.getElementById('theme-toggle-checkbox');
function applyTheme(theme) {
document.body.dataset.theme = theme;
const isLight = theme === 'light';
if (themeToggleCheckbox.checked !== isLight) {
themeToggleCheckbox.checked = isLight;
}
safeStorage.setItem('theme', theme);
}
function toggleTheme() {
const isLight = themeToggleCheckbox.checked;
applyTheme(isLight ? 'light' : 'dark');
}
const mainMenu = document.getElementById('mainMenu');
const calculatorContainer = document.getElementById('calculatorContainer');
const contractContainer = document.getElementById('contractContainer');
const stockContainer = document.getElementById('stockContainer');
const adminContainer = document.getElementById('administracao');
const topRightControls = document.getElementById('top-right-controls');
function showMainSection(sectionId) {
if (!isAuthReady) return;
if (productsListener) { off(getProductsRef(), 'value', productsListener); productsListener = null; }
if (boletosListener) { off(ref(db, 'boletos'), 'value', boletosListener); boletosListener = null; }
mainMenu.classList.add('hidden');
calculatorContainer.classList.add('hidden');
contractContainer.classList.add('hidden');
stockContainer.classList.add('hidden');
adminContainer.classList.add('hidden');
topRightControls.classList.add('hidden');
mainMenu.style.display = 'none';
calculatorContainer.style.display = 'none';
contractContainer.style.display = 'none';
stockContainer.style.display = 'none';
adminContainer.style.display = 'none';
if (sectionId === 'main') {
mainMenu.classList.remove('hidden');
mainMenu.style.display = 'flex';
topRightControls.classList.remove('hidden');
} else if (sectionId === 'calculator') {
calculatorContainer.classList.remove('hidden');
calculatorContainer.style.display = 'block';
openCalculatorSection('calculatorHome');
} else if (sectionId === 'contract') {
contractContainer.classList.remove('hidden');
contractContainer.style.display = 'flex';
loadContractDraft();
const toggle = document.getElementById('boletoModeToggle');
if (toggle.checked) {
toggle.checked = false;
toggle.dispatchEvent(new Event('change'));
}
} else if (sectionId === 'stock') {
stockContainer.classList.remove('hidden');
stockContainer.style.display = 'flex';
loadCheckedItems();
filterStockProducts();
} else if (sectionId === 'administracao') {
adminContainer.classList.remove('hidden');
adminContainer.style.display = 'flex';
filterAdminProducts();
}
currentMainSectionId = sectionId;
}
function renderRatesEditor() {
const accordionContainer = document.getElementById('ratesAccordion');
if (!areRatesLoaded || Object.keys(rates).length === 0) { accordionContainer.innerHTML = '<p class="text-center text-secondary">Aguardando carregamento das taxas...</p>'; return; }
accordionContainer.innerHTML = '';
Object.keys(rates).forEach((machine, index) => {
const machineData = rates[machine], isPagBank = machine === 'pagbank';
let machineContent = '';
if (isPagBank) {
let creditInputs = (machineData.credito || []).map((rate, i) => `<div class="col-md-4 col-6"><label class="form-label small">${i + 1}x</label><div class="input-group mb-2"><input type="number" step="0.01" class="form-control form-control-sm" value="${rate}" data-machine="${machine}" data-type="credito" data-installments="${i + 1}"><span class="input-group-text">%</span></div></div>`).join('');
machineContent = `<div class="row"><div class="col-md-4 col-6"><label class="form-label fw-bold">Débito</label><div class="input-group mb-3"><input type="number" step="0.01" class="form-control" value="${machineData.debito || 0}" data-machine="${machine}" data-type="debito"><span class="input-group-text">%</span></div></div></div><h5>Crédito</h5><div class="row">${creditInputs}</div>`;
} else {
const brands = Object.keys(machineData);
const navTabs = brands.map((brand, i) => `<li class="nav-item"><a class="nav-link ${i === 0 ? 'active' : ''}" id="tab-${machine}-${brand}" data-bs-toggle="tab" href="#content-${machine}-${brand}" role="tab">${brand.charAt(0).toUpperCase() + brand.slice(1)}</a></li>`).join('');
const tabContent = brands.map((brand, i) => {
const brandData = machineData[brand];
const creditInputs = (brandData.credito || []).map((rate, idx) => `<div class="col-md-4 col-6"><label class="form-label small">${idx + 1}x</label><div class="input-group mb-2"><input type="number" step="0.01" class="form-control form-control-sm" value="${rate}" data-machine="${machine}" data-brand="${brand}" data-type="credito" data-installments="${idx + 1}"><span class="input-group-text">%</span></div></div>`).join('');
return `<div class="tab-pane fade ${i === 0 ? 'show active' : ''}" id="content-${machine}-${brand}" role="tabpanel"><div class="row mt-3"><div class="col-md-4 col-6"><label class="form-label fw-bold">Débito</label><div class="input-group mb-3"><input type="number" step="0.01" class="form-control" value="${brandData.debito || 0}" data-machine="${machine}" data-brand="${brand}" data-type="debito"><span class="input-group-text">%</span></div></div></div><h5>Crédito</h5><div class="row">${creditInputs}</div></div>`;
}).join('');
machineContent = `<ul class="nav nav-tabs" role="tablist">${navTabs}</ul><div class="tab-content">${tabContent}</div>`;
}
accordionContainer.insertAdjacentHTML('beforeend', `<div class="accordion-item"><h2 class="accordion-header"><button class="accordion-button ${index > 0 ? 'collapsed' : ''}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${machine}">${machine.charAt(0).toUpperCase() + machine.slice(1)}</button></h2><div id="collapse-${machine}" class="accordion-collapse collapse ${index === 0 ? 'show' : ''}" data-bs-parent="#ratesAccordion"><div class="accordion-body">${machineContent}</div></div></div>`);
});
accordionContainer.querySelectorAll('[data-bs-toggle="tab"]').forEach(triggerEl => { if (!bootstrap.Tab.getInstance(triggerEl)) new bootstrap.Tab(triggerEl); });
}
async function saveRates() {
const updatedRates = JSON.parse(JSON.stringify(rates));
let hasError = false;
document.querySelectorAll('#adminRatesContent input[type="number"]').forEach(input => {
const { machine, brand, type, installments } = input.dataset;
const value = parseFloat(input.value);
if (isNaN(value)) { hasError = true; return; }
if (brand) { if (type === 'debito') updatedRates[machine][brand].debito = value; else if (type === 'credito') updatedRates[machine][brand].credito[parseInt(installments) - 1] = value; }
else { if (type === 'debito') updatedRates[machine].debito = value; else if (type === 'credito') updatedRates[machine].credito[parseInt(installments) - 1] = value; }
});
if (hasError) { showCustomModal({ message: "Corrija campos inválidos." }); return; }
try { await update(ref(db, 'rates'), updatedRates); showCustomModal({ message: "Taxas atualizadas!" }); }
catch (error) { console.error("Erro ao salvar taxas:", error); showCustomModal({ message: `Erro ao salvar: ${error.message}` }); }
}
let activeBrandSelect = null;
const flagData = { visa: { name: 'Visa', icon: 'bi-credit-card' }, mastercard: { name: 'Mastercard', icon: 'bi-credit-card-2-front-fill' }, hiper: { name: 'Hiper', icon: 'bi-card-heading' }, hipercard: { name: 'Hipercard', icon: 'bi-card-heading' }, elo: { name: 'Elo', icon: 'bi-credit-card-fill' }, amex: { name: 'Amex', icon: 'bi-person-badge' } };
function openFlagModal(machineSelectElement) {
const flagModalOverlay = document.getElementById('flagSelectorModalOverlay'), flagModalButtons = document.getElementById('flagSelectorButtons');
const machineValue = machineSelectElement.value, sectionNumber = machineSelectElement.id.replace('machine', '');
activeBrandSelect = document.getElementById(`brand${sectionNumber}`);
if (machineValue === 'pagbank' || !activeBrandSelect) { if (flagModalOverlay.classList.contains('active')) closeFlagModal(); return; }
flagModalButtons.innerHTML = '';
Array.from(activeBrandSelect.options).forEach(option => {
const brand = option.value, data = flagData[brand] || { name: brand.charAt(0).toUpperCase() + brand.slice(1), icon: 'bi-question-circle' };
const button = document.createElement('button');
button.className = 'btn-flag'; button.dataset.value = brand; button.innerHTML = `<i class="bi ${data.icon}"></i> ${data.name}`;
button.onclick = () => { activeBrandSelect.value = brand; activeBrandSelect.dispatchEvent(new Event('change', { bubbles: true })); closeFlagModal(); };
flagModalButtons.appendChild(button);
});
flagModalOverlay.classList.add('active');
}
function closeFlagModal() { document.getElementById('flagSelectorModalOverlay').classList.remove('active'); }
function updateFlagDisplay(sectionNumber) {
const brandSelect = document.getElementById(`brand${sectionNumber}`), displayButton = document.getElementById(`flagDisplayButton${sectionNumber}`);
if (!brandSelect || !displayButton) return;
const selectedBrand = brandSelect.value, data = flagData[selectedBrand] || { name: 'Select', icon: 'bi-question-circle'};
displayButton.innerHTML = `<i class="bi ${data.icon}"></i> ${data.name}`;
}
function escapeHtml(text) { const map = {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'}; return text ? text.toString().replace(/[&<>"']/g, m => map[m]) : ''; }
function parseBrazilianCurrencyToFloat(valueString) { let cleaned = String(valueString).replace(/R\$?\s?|💰|\$\s?/g, '').trim(); if (cleaned.includes(',')) { cleaned = cleaned.replace(/\./g, '').replace(',', '.'); } return parseFloat(cleaned); }
function openCalculatorSection(sectionId) {
if (!sectionId || !document.getElementById(sectionId)) sectionId = 'calculatorHome';
['calculatorHome', 'fecharVenda', 'repassarValores', 'calcularEmprestimo', 'calcularPorAparelho'].forEach(id => {
const el = document.getElementById(id);
if (el) el.style.display = 'none';
});
if (sectionId !== 'calcularPorAparelho') {
currentlySelectedProductForCalc = null;
}
document.getElementById(sectionId).style.display = 'flex';
currentCalculatorSectionId = sectionId;
const sectionInitializers = {
fecharVenda: () => { updateInstallmentsOptions(); updateFecharVendaUI(); },
repassarValores: () => { updateRepassarValoresUI(); },
calcularEmprestimo: () => { updateCalcularEmprestimoUI(); },
calcularPorAparelho: () => { updateCalcularPorAparelhoUI(); }
};
if (sectionInitializers[sectionId]) sectionInitializers[sectionId]();
}
function renderQuickInstallmentButtons() {
const container = document.getElementById('quickInstallmentsContainer');
const installmentsSlider = document.getElementById("installments1");
const maxInstallments = parseInt(installmentsSlider.max);
const quickValues = [8, 10, 12, 18];
container.innerHTML = '';
quickValues.forEach(value => {
if (value <= maxInstallments) {
const btn = document.createElement('button');
btn.className = 'quick-installment-btn';
btn.textContent = `${value}x`;
btn.dataset.value = value;
btn.addEventListener('click', () => {
installmentsSlider.value = value;
installmentsSlider.dispatchEvent(new Event('input', { bubbles: true }));
});
container.appendChild(btn);
}
});
}
function updateQuickButtonsActiveState() {
const installmentsSlider = document.getElementById("installments1");
const currentValue = installmentsSlider.value;
document.querySelectorAll('.quick-installment-btn').forEach(btn => {
btn.classList.toggle('active', btn.dataset.value === currentValue);
});
}
function updateInstallmentsOptions() {
const installmentsSlider = document.getElementById("installments1");
const machine = document.getElementById("machine1").value;
if (!areRatesLoaded) {
installmentsSlider.disabled = true;
return;
}
installmentsSlider.disabled = false;
let max = 0;
if (rates[machine]) {
switch(machine) {
case "pagbank": max = 18; break;
case "infinity": max = 12; break;
case "valorante": max = 21; break;
}
}
installmentsSlider.max = max;
if (parseInt(installmentsSlider.value) > max) {
installmentsSlider.value = 0;
}
renderQuickInstallmentButtons();
installmentsSlider.dispatchEvent(new Event('input'));
}
function toggleEntradaAVistaUI() {
const isProdutoMode = document.getElementById('vendaModeToggle').checked, isEntradaChecked = document.getElementById('entradaAVistaCheckbox').checked;
const entradaContainer = document.getElementById('entradaAVistaContainer'), finalValueContainer = document.getElementById('fecharVendaInputs'), entradaToggleContainer = document.getElementById('entradaAVistaToggleContainer');
entradaToggleContainer.classList.toggle('hidden', !isProdutoMode || fecharVendaPrecoBase <= 0);
if (isProdutoMode && isEntradaChecked) { entradaContainer.classList.remove('hidden'); finalValueContainer.classList.add('hidden'); document.getElementById('fecharVendaValue').value = ''; }
else { entradaContainer.classList.add('hidden'); finalValueContainer.classList.remove('hidden'); document.getElementById('valorEntradaAVista').value = ''; document.getElementById('valorPassadoNoCartao').value = ''; }
calculateFecharVenda();
}
function updateFecharVendaUI() {
const produtoContainer = document.getElementById('vendaPorProdutoContainer'), manualContainer = document.getElementById('manualModeContainer'), flagDisplayContainer = document.getElementById("flagDisplayContainer1");
const valueLabel = document.getElementById('fecharVendaValueLabel'), valueInput = document.getElementById('fecharVendaValue');
const isProdutoMode = document.getElementById('vendaModeToggle').checked, installments = parseInt(document.getElementById("installments1").value, 10), manualMode = document.querySelector('input[name="manualMode"]:checked').value, machine = document.getElementById("machine1").value;
if (isProdutoMode) {
manualContainer.classList.add('hidden');
produtoContainer.classList.remove('hidden');
}
else {
manualContainer.classList.remove('hidden');
produtoContainer.classList.add('hidden');
document.getElementById('vendaProdutoSearch').value = '';
document.getElementById('vendaSearchResultsContainer').innerHTML = '';
document.getElementById('fecharVendaPrecoBase').value = '';
fecharVendaPrecoBase = 0;
document.getElementById('entradaAVistaCheckbox').checked = false;
}
toggleEntradaAVistaUI();
if (!isProdutoMode) { valueLabel.innerHTML = (installments > 0 && manualMode === 'parcela') ? '<i class="bi bi-currency-dollar"></i> Valor da Parcela (R$)' : '<i class="bi bi-currency-dollar"></i> Valor Total da Venda (R$)'; valueInput.placeholder = (installments > 0 && manualMode === 'parcela') ? "Digite o valor da parcela" : "Digite o valor total"; }
flagDisplayContainer.style.display = (machine !== "pagbank") ? 'block' : 'none';
updateFlagDisplay('1'); calculateFecharVenda();
updateQuickButtonsActiveState();
}
function updateRepassarValoresUI() { const machine = document.getElementById("machine2").value; document.getElementById("flagDisplayContainer2").style.display = (machine !== "pagbank") ? 'block' : 'none'; updateFlagDisplay('2'); calculateRepassarValores(); }
function updateCalcularEmprestimoUI() { const machine = document.getElementById("machine4").value; document.getElementById("flagDisplayContainer4").style.display = (machine !== "pagbank") ? 'block' : 'none'; updateFlagDisplay('4'); calculateEmprestimo(); }
function updateCalcularPorAparelhoUI() {
const machine = document.getElementById("machine3").value;
document.getElementById("flagDisplayContainer3").style.display = (machine !== "pagbank") ? 'block' : 'none';
updateFlagDisplay('3');
renderAparelhoFavorites();
calculateAparelho();
}
function getRate(machine, brand, installments) { if (!areRatesLoaded || !rates[machine]) return undefined; if (machine === 'pagbank') return installments === 0 ? rates.pagbank.debito : rates.pagbank.credito[installments - 1]; const rateSet = (machine === 'infinity' && brand === 'hiper') ? rates.infinity.hiper : rates[machine][brand === 'hiper' ? 'hipercard' : brand]; return rateSet ? (installments === 0 ? rateSet.debito : rateSet.credito[installments - 1]) : undefined; }
function calculateFecharVenda() {
if (!areRatesLoaded) return;
const resultDiv = document.getElementById("resultFecharVenda"), isProdutoMode = document.getElementById('vendaModeToggle').checked, isEntradaAVista = document.getElementById('entradaAVistaCheckbox').checked;
const installments = parseInt(document.getElementById("installments1").value, 10), tax = getRate(document.getElementById("machine1").value, document.getElementById("brand1").value, installments);
const foneDescontado = document.getElementById('descontarFoneCheckbox')?.checked || false, valorDesconto = 15;
let checkboxHtml = '';
if (tax === undefined || tax === null) { resultDiv.innerHTML = `<div class="alert alert-warning d-flex align-items-center"><i class="bi bi-exclamation-triangle-fill me-3"></i>Taxa não disponível.</div>`; return; }
if (isProdutoMode && fecharVendaPrecoBase > 0) checkboxHtml = `<div class="form-check form-check-inline mt-3 w-100" style="max-width: 400px; margin-left: auto; margin-right: auto; text-align: left; padding-left: 2.5em;"><input class="form-check-input" type="checkbox" id="descontarFoneCheckbox" ${foneDescontado ? 'checked' : ''}><label class="form-check-label" for="descontarFoneCheckbox">Descontar fone Bluetooth (${valorDesconto.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })})</label></div>`;
if (isProdutoMode && isEntradaAVista) {
const valorEntrada = parseFloat(document.getElementById('valorEntradaAVista').value) || 0, valorCartao = parseFloat(document.getElementById('valorPassadoNoCartao').value) || 0;
if (fecharVendaPrecoBase <= 0) { resultDiv.innerHTML = `<div class="alert alert-info d-flex align-items-center"><i class="bi bi-info-circle-fill me-3"></i>Selecione um produto.</div>`; return; }
if (valorCartao <= 0) { resultDiv.innerHTML = checkboxHtml || ""; return; }
const liquidCartao = valorCartao * (1 - tax / 100);
let totalRecebido = valorEntrada + liquidCartao;
if (foneDescontado) totalRecebido -= valorDesconto;
const lucroExtra = totalRecebido - fecharVendaPrecoBase;
resultDiv.innerHTML = `<div class="alert alert-success fs-5 w-100 text-start" style="max-width: 400px; margin: 0 auto;"><div class="d-flex align-items-start"><i class="bi bi-check-circle-fill me-3 fs-4"></i><div><strong>Valor Total Recebido: ${totalRecebido.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</strong><br/><small class="text-secondary">sendo ${valorEntrada.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} à vista + ${valorCartao.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} (tax. ${tax.toFixed(2)}%)</small><br/><strong class="mt-2 d-block">Lucro Extra: <span class="lucro-extra-valor">${lucroExtra.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span></strong></div></div></div>` + checkboxHtml;
return;
}
const inputValue = parseFloat(document.getElementById("fecharVendaValue").value);
if (isNaN(inputValue) || inputValue <= 0) { resultDiv.innerHTML = checkboxHtml || ""; return; }
const manualMode = document.querySelector('input[name="manualMode"]:checked').value;
let totalValue = (!isProdutoMode && manualMode === 'parcela' && installments > 0) ? inputValue * installments : inputValue;
const liquid = totalValue * (1 - tax / 100);
let liquidExibido = liquid, lucroExtraHtml = '';
if (isProdutoMode && fecharVendaPrecoBase > 0) {
if (foneDescontado) liquidExibido -= valorDesconto;
const lucroExtra = liquidExibido - fecharVendaPrecoBase;
lucroExtraHtml = `<hr class="my-2" style="border-color: rgba(255,255,255,0.2);"><strong>Lucro Extra: <span class="${lucroExtra >= 0 ? 'text-success' : 'text-danger'}">${lucroExtra.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span></strong>`;
}
resultDiv.innerHTML = `<div class="alert alert-success fs-5 w-100 text-start d-flex align-items-start" style="max-width: 400px; margin: 0 auto;"><i class="bi bi-check-circle-fill me-3 fs-4"></i><div><strong>Valor Líquido: ${liquidExibido.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</strong><br/><small class="text-secondary">Taxa: ${tax.toFixed(2)}% (${installments === 0 ? "Débito" : `${installments}x`})</small>${lucroExtraHtml}</div></div>` + checkboxHtml;
}
function calculateRepassarValores() {
const resultDiv = document.getElementById("resultRepassarValores");
const exportContainer = document.getElementById('exportRepassarContainer');
if (!areRatesLoaded) return;
const valorDesejado = parseFloat(document.getElementById("repassarValue").value);
if (isNaN(valorDesejado) || valorDesejado <= 0) {
resultDiv.innerHTML = "";
exportContainer.style.display = 'none';
return;
}
const machine = document.getElementById("machine2").value, brand = document.getElementById("brand2").value;
let maxInstallments = 0;
if (rates[machine]) {
switch(machine) {
case "pagbank": maxInstallments = 18; break;
case "infinity": maxInstallments = 12; break;
case "valorante": maxInstallments = 21; break;
}
}
let tableRows = "";
const debitTax = getRate(machine, brand, 0);
if(debitTax !== null && debitTax !== undefined) {
const valorBrutoDebito = valorDesejado / (1 - debitTax / 100);
tableRows += `<tr class="debit-row"><td>Débito</td><td>-</td><td>${valorBrutoDebito.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td></tr>`;
}
for (let i = 1; i <= maxInstallments; i++) {
const creditTax = getRate(machine, brand, i);
if (creditTax !== undefined) {
const valorBrutoCredit = valorDesejado / (1 - creditTax / 100), valorParcela = valorBrutoCredit / i;
tableRows += `<tr><td>${i}x</td><td>${valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td><td>${valorBrutoCredit.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td></tr>`;
}
}
if (tableRows) {
resultDiv.innerHTML = `<div class="table-responsive"><table class="table results-table"><thead><tr><th>Parcelas</th><th>Valor da Parcela</th><th>Total a Passar</th></tr></thead><tbody>${tableRows}</tbody></table></div>`;
} else {
resultDiv.innerHTML = "";
}
exportContainer.style.display = tableRows.trim() !== "" ? 'block' : 'none';
}
function calculateEmprestimo() {
const resultDiv = document.getElementById("resultCalcularEmprestimo");
const exportContainer = document.getElementById('exportEmprestimoContainer');
if (!areRatesLoaded) return;
const valorBase = parseFloat(document.getElementById("emprestimoValue").value) || 0;
const lucro = valorBase * (emprestimoLucroPercentual / 100);
const valorDesejado = valorBase + lucro;
const lucroDisplay = document.getElementById("emprestimoLucroDisplay");
const valorLiquidoDisplay = document.getElementById("valorLiquidoDisplay");
lucroDisplay.innerHTML = `🟢 Lucro ${emprestimoLucroPercentual}% = <span>${lucro.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>`;
if (valorBase <= 0) {
valorLiquidoDisplay.innerHTML = "";
resultDiv.innerHTML = "";
exportContainer.style.display = 'none';
return;
}
valorLiquidoDisplay.innerHTML = `<div class="alert alert-info d-flex align-items-center w-100" style="max-width: 400px; margin: 0 auto;"><i class="bi bi-info-circle-fill me-3"></i><div>Valor líquido a receber: <strong>${valorDesejado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</strong></div></div>`;
const machine = document.getElementById("machine4").value;
const brand = document.getElementById("brand4").value;
let maxInstallments = 0;
if (rates[machine]) { switch (machine) { case "pagbank": maxInstallments = 18; break; case "infinity": maxInstallments = 12; break; case "valorante": maxInstallments = 21; break; } }
let tableRows = "";
const debitTax = getRate(machine, brand, 0);
if (debitTax !== null && debitTax !== undefined) {
const valorBrutoDebito = valorDesejado / (1 - debitTax / 100);
tableRows += `<tr class="debit-row"><td>Débito</td><td>-</td><td>${valorBrutoDebito.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td></tr>`;
}
for (let i = 1; i <= maxInstallments; i++) {
const creditTax = getRate(machine, brand, i);
if (creditTax !== undefined) {
const valorBrutoCredit = valorDesejado / (1 - creditTax / 100);
const valorParcela = valorBrutoCredit / i;
tableRows += `<tr><td>${i}x</td><td>${valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td><td>${valorBrutoCredit.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td></tr>`;
}
}
if (tableRows) {
resultDiv.innerHTML = `<div class="table-responsive"><table class="table results-table"><thead><tr><th>Parcelas</th><th>Valor da Parcela</th><th>Total a Passar</th></tr></thead><tbody>${tableRows}</tbody></table></div>`;
} else {
resultDiv.innerHTML = "";
}
exportContainer.style.display = tableRows.trim() !== "" ? 'block' : 'none';
}
function calculateAparelho() {
if (!areRatesLoaded) return;
const resultDiv = document.getElementById('resultCalcularPorAparelho');
const exportContainer = document.getElementById('exportAparelhoContainer');
const entradaValue = parseFloat(document.getElementById('entradaAparelho').value) || 0;
const extraValue = parseFloat(document.getElementById('valorExtraAparelho').value) || 0;
if (isNaN(selectedAparelhoValue) || selectedAparelhoValue <= 0) {
resultDiv.innerHTML = '<div class="alert alert-warning d-flex align-items-center mt-3 w-100" style="max-width: 400px;"><i class="bi bi-exclamation-triangle-fill me-3"></i>Selecione um aparelho.</div>';
exportContainer.style.display = 'none';
return;
}
const valorTotalAparelho = selectedAparelhoValue + extraValue;
const valorBaseParaCalculo = valorTotalAparelho - entradaValue;
let headerHtml = `<h4 class="mt-4">Preço Total: ${valorTotalAparelho.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</h4>`;
if (entradaValue > 0) {
headerHtml += `<div class="alert alert-info d-flex align-items-center w-100" style="max-width: 400px;"><i class="bi bi-info-circle-fill me-3"></i><div><strong>Entrada:</strong> ${entradaValue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}<br><strong>Valor a Parcelar:</strong> ${valorBaseParaCalculo.toLocaleString('pt-BR', { style: 'currency', 'currency': 'BRL' })}</div></div>`;
}
if (valorBaseParaCalculo < 0) {
resultDiv.innerHTML = headerHtml + '<div class="alert alert-danger d-flex align-items-center mt-3 w-100" style="max-width: 400px;"><i class="bi bi-x-circle-fill me-3"></i>O valor da entrada não pode ser maior que o valor do aparelho.</div>';
exportContainer.style.display = 'none';
return;
}
if (valorBaseParaCalculo <= 0) {
resultDiv.innerHTML = headerHtml + '<div class="alert alert-success d-flex align-items-center mt-3 w-100" style="max-width: 400px;"><i class="bi bi-check-circle-fill me-3"></i>Aparelho quitado com a entrada.</div>';
exportContainer.style.display = 'none';
return;
}
const machine = document.getElementById("machine3").value;
const brand = document.getElementById("brand3").value;
let maxInstallments = 0;
if (rates[machine]) { switch(machine) { case "pagbank": maxInstallments = 18; break; case "infinity": maxInstallments = 12; break; case "valorante": maxInstallments = 21; break; } }
let tableRows = "";
const debitTax = getRate(machine, brand, 0);
if (debitTax !== null && debitTax !== undefined) {
const valorBrutoDebito = valorBaseParaCalculo / (1 - debitTax / 100);
tableRows += `<tr class="debit-row copyable-row" data-installments="Débito" data-parcela="${valorBrutoDebito.toFixed(2)}" data-total="${valorBrutoDebito.toFixed(2)}"><td>Débito</td><td>-</td><td>${valorBrutoDebito.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td></tr>`;
}
for (let i = 1; i <= maxInstallments; i++) {
const creditTax = getRate(machine, brand, i);
if (creditTax !== undefined) {
const valorBrutoCredit = valorBaseParaCalculo / (1 - creditTax / 100), valorParcela = valorBrutoCredit / i;
tableRows += `<tr class="copyable-row" data-installments="${i}" data-parcela="${valorParcela.toFixed(2)}" data-total="${valorBrutoCredit.toFixed(2)}"><td>${i}x</td><td>${valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td><td>${valorBrutoCredit.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td></tr>`;
}
}
let finalHtml = headerHtml;
if(tableRows) {
finalHtml += `<div class="table-responsive"><table class="table results-table"><thead><tr><th>Parcelas</th><th>Valor da Parcela</th><th>Total a Passar</th></tr></thead><tbody>${tableRows}</tbody></table></div>`;
}
resultDiv.innerHTML = finalHtml;
exportContainer.style.display = tableRows.trim() !== "" ? 'block' : 'none';
}
function handleProductSelectionForAparelho(product) {
currentlySelectedProductForCalc = product;
document.getElementById('saveAparelhoFavoriteBtn').classList.remove('hidden');
selectedAparelhoValue = parseFloat(product.valor);
document.getElementById('aparelhoSearch').value = `${product.nome}`;
document.getElementById('aparelhoResultsContainer').innerHTML = '';
document.getElementById('entradaAparelho').value = '';
document.getElementById('valorExtraAparelho').value = '';
const infoNoteEl = document.getElementById('aparelhoInfoNote');
if (product.lastCheckedTimestamp) {
const date = new Date(product.lastCheckedTimestamp).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
const colorsString = (product.cores && product.cores.length > 0)
? product.cores.map(c => c.nome).join(', ')
: 'Nenhuma cor cadastrada';
infoNoteEl.innerHTML = `<i class="bi bi-info-circle"></i> Última checagem em ${date} - Cores: ${colorsString}`;
infoNoteEl.classList.remove('hidden');
} else {
infoNoteEl.classList.add('hidden');
}
calculateAparelho();
}
function handleProductSelectionForVenda(product) {
fecharVendaPrecoBase = parseFloat(product.valor);
document.getElementById('fecharVendaPrecoBase').value = fecharVendaPrecoBase.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
document.getElementById('vendaProdutoSearch').value = product.nome;
document.getElementById('vendaSearchResultsContainer').innerHTML = '';
if (!document.getElementById('entradaAVistaCheckbox').checked) {
const tax = getRate(document.getElementById("machine1").value, document.getElementById("brand1").value, parseInt(document.getElementById("installments1").value, 10));
document.getElementById('fecharVendaValue').value = (tax !== undefined) ? (fecharVendaPrecoBase / (1 - tax / 100)).toFixed(2) : fecharVendaPrecoBase.toFixed(2);
}
updateFecharVendaUI();
}
async function exportResultsToImage(resultsContainerId, fileName = 'calculo-taxas.png', headerHtml = '') {
const resultsEl = document.getElementById(resultsContainerId);
if (!resultsEl || !resultsEl.innerHTML.trim()) {
showCustomModal({ message: "Não há resultados para exportar." });
return;
}
const exportContainer = document.createElement('div');
exportContainer.className = 'export-container-temp';
exportContainer.style.position = 'absolute';
exportContainer.style.left = '-9999px';
exportContainer.style.padding = '25px';
exportContainer.style.borderRadius = 'var(--border-radius)';
exportContainer.style.width = 'auto';
exportContainer.style.maxWidth = '600px';
const isLightTheme = document.body.dataset.theme === 'light';
exportContainer.style.backgroundColor = isLightTheme ? '#ffffff' : '#1A1A1A';
exportContainer.dataset.theme = document.body.dataset.theme;
const textColor = isLightTheme ? '#000000' : '#FFFFFF';
const headerColor = isLightTheme ? '#333333' : '#DDDDDD';
const exportStyles = `
<style>
.export-container-temp { color: ${textColor} !important; }
.results-table { --bs-table-color: ${textColor}; --bs-table-border-color: rgba(255,255,255,0.2); }
.results-table th, .results-table td { color: ${textColor} !important; font-weight: 500 !important; }
.results-table th { color: ${headerColor} !important; }
.results-table .debit-row td { font-weight: 600 !important; }
h4 { color: ${textColor} !important; }
</style>
`;
exportContainer.innerHTML = exportStyles + headerHtml + resultsEl.innerHTML;
document.body.appendChild(exportContainer);
document.body.classList.add('exporting-image');
try {
await new Promise(resolve => setTimeout(resolve, 100));
const canvas = await html2canvas(exportContainer, {
backgroundColor: null,
scale: 2,
useCORS: true,
logging: false
});
const link = document.createElement('a');
link.download = fileName;
link.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
link.click();
} catch (error) {
console.error('Erro ao exportar imagem:', error);
showCustomModal({ message: 'Ocorreu um erro ao gerar a imagem.' });
} finally {
document.body.classList.remove('exporting-image');
if(document.body.contains(exportContainer)){
document.body.removeChild(exportContainer);
}
}
}
function showSkeletonLoader(container) {
if(!container) return;
container.classList.add('is-loading');
let skeletonHTML = '';
for(let i=0; i<3; i++) {
skeletonHTML += '<div class="skeleton skeleton-item"></div>';
}
container.innerHTML = skeletonHTML;
}
function hideSkeletonLoader(container) {
if(!container) return;
container.classList.remove('is-loading');
container.innerHTML = '';
}
function loadRatesFromDB() { const ratesRef = ref(db, 'rates'); onValue(ratesRef, (snapshot) => { if (snapshot.exists()) { rates = snapshot.val(); areRatesLoaded = true; updateInstallmentsOptions(); console.log("Taxas carregadas."); if (currentMainSectionId === 'administracao' && document.getElementById('adminModeToggle')?.checked) renderRatesEditor(); } else { console.error("ERRO: As taxas não foram encontradas."); showCustomModal({ message: "Erro crítico: Não foi possível carregar as taxas." }); } }, (error) => { console.error("Erro ao carregar taxas:", error); showCustomModal({ message: `Erro ao carregar taxas: ${error.message}` }); }); }
const getProductsRef = () => ref(db, 'products');
function loadProductsFromDB() {
if (!db || !isAuthReady) return;
const searchContainers = [document.getElementById('vendaSearchResultsContainer'), document.getElementById('aparelhoResultsContainer')];
searchContainers.forEach(c => showSkeletonLoader(c));
if (productsListener) off(getProductsRef(), 'value', productsListener);
productsListener = onValue(getProductsRef(), (snapshot) => {
searchContainers.forEach(c => hideSkeletonLoader(c));
const data = snapshot.val(); products = data ? Object.keys(data).map(key => ({ id: key, ...data[key] })) : [];
setupFuse();
const aparelhoContent = document.getElementById('aparelhoContentWrapper');
const aparelhoEmptyState = document.getElementById('aparelhoEmptyStateWrapper');
if (products.length === 0) {
if (aparelhoContent) aparelhoContent.classList.add('hidden');
if (aparelhoEmptyState) aparelhoEmptyState.classList.remove('hidden');
} else {
if (aparelhoContent) aparelhoContent.classList.remove('hidden');
if (aparelhoEmptyState) aparelhoEmptyState.classList.add('hidden');
}
const placeholderText = products.length > 0 ? `Pesquisar entre ${products.length} produtos...` : 'Nenhum produto cadastrado';
document.getElementById('vendaProdutoSearch').placeholder = placeholderText;
document.getElementById('aparelhoSearch').placeholder = placeholderText;
if(document.getElementById('adminSearchInput')) document.getElementById('adminSearchInput').placeholder = `Filtrar ${products.length} produtos...`;
if (currentMainSectionId === 'administracao') filterAdminProducts();
if (currentMainSectionId === 'stock') filterStockProducts();
}, (error) => {
console.error("Firebase Read Error:", error);
searchContainers.forEach(c => hideSkeletonLoader(c));
});
}
async function updateProductInDB(id, data) { try { await update(ref(db, `products/${id}`), data); } catch (error) { console.error(`Erro ao atualizar: ${error.message}`); } }
function renderAdminProductList(filteredList = products) {
const container = document.getElementById('productsListContainer');
if (!container) return;
const tags = getTagList();
if (filteredList.length === 0) {
container.innerHTML = `
<div class="text-center p-5">
<i class="bi bi-journal-x" style="font-size: 4rem; color: var(--text-secondary);"></i>
<h5 class="mt-3">Nenhum produto encontrado</h5>
<p class="text-secondary">Adicione um novo produto para começar.</p>
</div>`;
} else {
container.innerHTML = filteredList.map(product => {
const tagOptions = tags.map(tag => `<option value="${escapeHtml(tag)}" ${product.tag === tag ? 'selected' : ''}>${escapeHtml(tag)}</option>`).join('');
return `
<div class="admin-product-card" data-id="${product.id}">
<div class="admin-product-card-grid">
<div class="form-group full-width">
<label class="form-label">Nome do Produto</label>
<input type="text" class="form-control" value="${escapeHtml(product.nome)}" data-field="nome">
</div>
<div class="form-group">
<label class="form-label">Valor</label>
<input type="text" class="form-control" value="${(product.valor || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}" data-field="valor">
</div>
<div class="form-group">
<label class="form-label">Qtd.</label>
<input type="number" class="form-control text-center" value="${product.quantidade || 0}" data-field="quantidade" min="0" step="1">
</div>
<div class="form-group full-width">
<label class="form-label">Etiqueta</label>
<select class="form-select" data-field="tag">${tagOptions}</select>
</div>
</div>
<div class="admin-product-actions">
<div class="form-check form-switch">
<input class="form-check-input ignore-toggle-switch-admin" type="checkbox" role="switch" id="ignore-admin-${product.id}" data-id="${product.id}" ${product.ignorarContagem ? 'checked' : ''}>
<label class="form-check-label" for="ignore-admin-${product.id}">Ignorar</label>
</div>
<button class="btn btn-sm btn-outline-danger delete-product-btn" data-id="${product.id}"><i class="bi bi-trash"></i> Apagar</button>
</div>
</div>`;
}).join('');
}
}
function filterAdminProducts() { const searchTerm = document.getElementById('adminSearchInput').value; renderAdminProductList(!fuse || !searchTerm ? products : fuse.search(searchTerm).map(r => r.item)); }
async function importFromPasteOrFile(content) {
const lines = content.split('\n').filter(line => line.trim());
const productsToImport = lines.map(line => {
const parts = line.split('-').map(p => p.trim());
if (parts.length >= 2) {
const nome = parts[0];
const valor = parseBrazilianCurrencyToFloat(parts[1]);
const quantidade = parts.length > 2 ? parseInt(parts[2], 10) : 1;
if (nome && !isNaN(valor) && !isNaN(quantidade)) {
return { nome, valor, quantidade, cores: [], ignorarContagem: false, tag: 'Nenhuma' };
}
}
return null;
}).filter(Boolean);
if (productsToImport.length > 0) {
try {
const updates = {};
productsToImport.forEach(p => {
const newKey = push(getProductsRef()).key;
updates[newKey] = p;
});
await update(getProductsRef(), updates);
showCustomModal({ message: `${productsToImport.length} produtos importados!` });
} catch (error) {
showCustomModal({ message: `Erro ao importar: ${error.message}` });
}
} else {
showCustomModal({ message: 'Nenhum produto válido encontrado.' });
}
}
function exportProducts(format) { const dataStr = format === 'txt' ? products.map(p => `${p.nome} - ${(p.valor || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`).join('\n') : JSON.stringify(products.map(({id, ...rest}) => rest), null, 2); const blob = new Blob([dataStr], { type: `text/${format === 'txt' ? 'plain' : 'json'}` }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `products.${format}`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(a.href); }
function showCustomModal({ message, onConfirm, onCancel, showPassword = false, confirmText = 'OK', cancelText = 'Cancelar' }) {
const isInformational = typeof onConfirm !== 'function' && typeof onCancel !== 'function' && !showPassword;
if (isInformational) {
const toast = document.getElementById('toastNotification');
if (toast.currentTimeout) {
clearTimeout(toast.currentTimeout);
}
toast.textContent = message;
toast.classList.add('show');
toast.currentTimeout = setTimeout(() => {
toast.classList.remove('show');
}, 2000);
return;
}
const overlay = document.getElementById('customModalOverlay');
const messageEl = document.getElementById('customModalMessage');
const passInput = document.getElementById('customModalPasswordInput');
const okBtn = overlay.querySelector('.btn-ok');
const cancelBtn = overlay.querySelector('.btn-cancel');
const buttonsContainer = document.getElementById('customModalButtons');
const closeModal = () => {
overlay.classList.remove('active');
};
messageEl.textContent = message;
passInput.value = '';
passInput.classList.toggle('hidden', !showPassword);
buttonsContainer.classList.remove('hidden');
if (typeof onConfirm === 'function') {
okBtn.textContent = confirmText;
okBtn.style.display = 'inline-flex';
okBtn.onclick = () => {
closeModal();
onConfirm(passInput.value);
};
} else {
okBtn.style.display = 'none';
}
if (typeof onCancel === 'function') {
cancelBtn.textContent = cancelText;
cancelBtn.style.display = 'inline-flex';
cancelBtn.onclick = () => {
closeModal();
onCancel();
};
} else {
cancelBtn.style.display = 'none';
}
overlay.classList.add('active');
if (showPassword) {
passInput.focus();
}
}
async function deleteAllProducts() { showCustomModal({ message: "Para excluir TODOS os produtos, digite 'excluir'.", showPassword: true, confirmText: "Excluir", onConfirm: async (password) => { if (password === "excluir") { showCustomModal({ message: "Ação IRREVERSÍVEL. Apagar TUDO?", confirmText: 'SIM, EXCLUIR', onConfirm: async () => { try { await remove(getProductsRef()); showCustomModal({message: 'Todos os produtos foram excluídos.'}); } catch (error) { showCustomModal({ message: `Erro: ${error.message}` }); } }, onCancel: () => {} }); } else showCustomModal({ message: "Senha incorreta." }); }, onCancel: () => {} }); }
function displayDynamicSearchResults(searchTerm, resultsContainerId, onItemClick) { const resultsContainer = document.getElementById(resultsContainerId); resultsContainer.innerHTML = ''; if (!fuse || !searchTerm || searchTerm.length < 2) return; const results = fuse.search(searchTerm); results.slice(0, 10).forEach(result => { const product = result.item; const a = document.createElement('a'); a.href = '#'; a.className = 'list-group-item list-group-item-action'; a.textContent = `${product.nome} - ${(product.valor || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`; a.onclick = (e) => { e.preventDefault(); onItemClick(product); }; resultsContainer.appendChild(a); }); }
function setupFuse() {
fuse = new Fuse(products, {
keys: ['nome'],
includeScore: true,
threshold: 0.3,
minMatchCharLength: 2,
});
}
let currentEditingProductId = null;
let tempSelectedColors = [];
const colorPalette = [
{ nome: 'Preto', hex: '#212121' }, { nome: 'Branco', hex: '#FFFFFF' }, { nome: 'Cinza Espacial', hex: '#535559' }, { nome: 'Prata', hex: '#E0E0E0' },
{ nome: 'Dourado', hex: '#FFD700' }, { nome: 'Rosê', hex: '#E0BFB8' }, { nome: 'Rosa', hex: '#FFC0CB' }, { nome: 'Rosa Claro', hex: '#FFD1DC' },
{ nome: 'Titânio Natural', hex: '#8A837E' }, { nome: 'Titânio Azul', hex: '#2E435E' }, { nome: 'Titânio Branco', hex: '#F5F5F7'}, { nome: 'Titânio Preto', hex: '#4A4A4A'},
{ nome: 'Azul', hex: '#1565C0' }, { nome: 'Azul-Céu', hex: '#87CEEB' }, { nome: 'Azul-Sierra', hex: '#A9C2D8' }, { nome: 'Verde', hex: '#2E7D32' },
{ nome: 'Verde-Menta', hex: '#98FF98' }, { nome: 'Verde-Alpino', hex: '#597D61' }, { nome: 'Roxo', hex: '#6A1B9A' }, { nome: 'Roxo Profundo', hex: '#4B0082'},
{ nome: 'Lilás', hex: '#C8A2C8' }, { nome: 'Vermelho', hex: '#C62828' }, { nome: 'Laranja', hex: '#F57C00' }, { nome: 'Coral', hex: '#FF7F50' },
{ nome: 'Amarelo', hex: '#FBC02D' }, { nome: 'Creme', hex: '#FFFDD0' }, { nome: 'Grafite', hex: '#455A64' }
];
function loadCheckedItems() {
const stored = safeStorage.getItem(CHECKED_ITEMS_KEY);
checkedItems = stored ? JSON.parse(stored) : {};
}
function saveCheckedItems() {
safeStorage.setItem(CHECKED_ITEMS_KEY, JSON.stringify(checkedItems));
}
function renderStockList(list) {
const container = document.getElementById('stockTableBody');
if (!container) return;
const sortedList = [...list].sort((a, b) => {
const aIsChecked = checkedItems[a.id]?.checked || false;
const bIsChecked = checkedItems[b.id]?.checked || false;
if (aIsChecked !== bIsChecked) {
return aIsChecked ? 1 : -1;
}
return a.nome.localeCompare(b.nome);
});
if (sortedList.length === 0) {
container.innerHTML = `<div class="text-center p-5"><i class="bi bi-box-seam" style="font-size: 3rem; color: var(--text-secondary);"></i><h5 class="mt-3">Nenhum produto para exibir.</h5><p class="text-secondary">Verifique os filtros ou adicione produtos na Administração.</p></div>`;
} else {
container.innerHTML = sortedList.map(product => {
const isChecked = checkedItems[product.id]?.checked || false;
const cardClass = isChecked ? 'is-checked' : 'not-checked';
return `
<div class="stock-item-card ${cardClass}" data-id="${product.id}">
<div class="stock-item-main">
<div class="product-info">
<div class="product-name">${escapeHtml(product.nome)}</div>
<div class="product-colors-display">${(product.cores || []).map(cor => `<div class="color-swatch-sm" style="background-color:${cor.hex};" title="${cor.nome}"></div>`).join('')}</div>
</div>
<div class="form-check form-switch d-flex align-items-center">
<input class="form-check-input stock-checked-toggle" type="checkbox" title="Marcar como conferido" id="check-${product.id}" data-id="${product.id}" ${isChecked ? 'checked' : ''}>
</div>
</div>
<div class="stock-item-controls">
<div class="input-group input-group-sm">
<button class="btn btn-outline-secondary stock-qty-btn" data-change="-1" aria-label="Diminuir">-</button>
<input type="number" class="form-control text-center stock-qty-input px-1" value="${product.quantidade || 0}" min="0" step="1" style="max-width: 70px;">
<button class="btn btn-outline-secondary stock-qty-btn" data-change="1" aria-label="Aumentar">+</button>
</div>
<div class="d-flex align-items-center gap-2">
<button class="btn btn-sm btn-secondary open-color-picker-btn" data-id="${product.id}" title="Editar Cores"><i class="bi bi-palette-fill"></i></button>
<button class="btn btn-sm btn-secondary ignore-toggle-btn" data-id="${product.id}" title="${product.ignorarContagem ? 'Mostrar na contagem' : 'Ignorar na contagem'}">
<i class="bi ${product.ignorarContagem ? 'bi-eye-slash-fill' : 'bi-eye-fill'}"></i>
</button>
</div>
</div>
</div>
`}).join('');
}
}
function filterStockProducts() {
const searchTerm = document.getElementById('stockSearchInput').value;
let baseList;
if (onlyShowIgnored) {
baseList = products.filter(p => p.ignorarContagem);
} else {
baseList = products.filter(p => !p.ignorarContagem);
}
const fuseInstance = new Fuse(baseList, { keys: ['nome'], threshold: 0.4 });
const filtered = !searchTerm ? baseList : fuseInstance.search(searchTerm).map(r => r.item);
renderStockList(filtered);
}
function generateStockReport() {
const reportPreview = document.getElementById('reportPreview');
const visibleProducts = onlyShowIgnored ? products.filter(p => p.ignorarContagem) : products.filter(p => !p.ignorarContagem);
const searchTerm = document.getElementById('stockSearchInput').value;
const fuseInstance = new Fuse(visibleProducts, { keys: ['nome'], threshold: 0.4 });
const filteredProducts = !searchTerm ? visibleProducts : fuseInstance.search(searchTerm).map(r => r.item);
const today = new Date();
const dateString = today.toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' });
const timeString = today.toLocaleTimeString('pt-BR');
let reportHTML = `
<h3>Relatório de Estoque</h3>
<p>Gerado em: ${dateString} às ${timeString}</p>
<table>
<thead>
<tr>
<th style="width: 50%;">Produto</th>
<th style="width: 30%;">Cores Disponíveis</th>
<th style="width: 20%; text-align: center;">Quantidade</th>
</tr>
</thead>
<tbody>
${filteredProducts.map(p => {
const isChecked = checkedItems[p.id]?.checked || false;
const rowStyle = !isChecked ? 'style="color: red !important;"' : '';
const notCheckedIndicator = !isChecked ? ' <strong style="color: red !important;">(NÃO CONFERIDO)</strong>' : '';
return `
<tr ${rowStyle}>
<td>${escapeHtml(p.nome)}${notCheckedIndicator}</td>
<td>${(p.cores || []).map(c => c.nome).join(', ') || '-'}</td>
<td style="text-align: center;">${p.quantidade || 0}</td>
</tr>
`;
}).join('')}
</tbody>
</table>
<p style="text-align: left; font-size: 8pt; color: #555; margin-top: 15px;">* Itens em vermelho não foram marcados como conferidos.</p>
`;
reportPreview.innerHTML = reportHTML;
document.body.classList.add('print-only-report');
window.print();
}
function openColorPicker(productId) {
currentEditingProductId = productId;
const product = products.find(p => p.id === productId);
if (!product) return;
tempSelectedColors = [...(product.cores || [])];
document.getElementById('colorPickerProductName').textContent = product.nome;
renderColorPickerPalette();
renderSelectedColors();
document.getElementById('customColorNameInput').value = '';
document.getElementById('customColorHexInput').value = '#CCCCCC';
document.getElementById('colorPickerModalOverlay').classList.add('active');
}
function renderColorPickerPalette() {
const paletteContainer = document.getElementById('colorPalette');
paletteContainer.innerHTML = colorPalette.map(color => {
const isSelected = tempSelectedColors.some(sc => sc.hex.toLowerCase() === color.hex.toLowerCase());
return `<div class="color-swatch-lg ${isSelected ? 'selected' : ''}" style="background-color: ${color.hex}" data-hex="${color.hex}" data-nome="${color.nome}" title="${color.nome}"></div>`;
}).join('');
}
function renderSelectedColors() {
const selectedContainer = document.getElementById('selectedColors');
if (tempSelectedColors.length === 0) {
selectedContainer.innerHTML = '<p class="text-secondary small">Nenhuma cor selecionada.</p>';
} else {
selectedContainer.innerHTML = tempSelectedColors.map(color => `
<div class="selected-color-tag">
<div class="color-swatch-sm" style="background-color: ${color.hex}"></div>
<span>${color.nome}</span>
<span class="remove-color-btn" data-hex="${color.hex}">&times;</span>
</div>
`).join('');
}
}
function toggleColorSelection(hex, nome) {
const index = tempSelectedColors.findIndex(c => c.hex.toLowerCase() === hex.toLowerCase());
if (index > -1) {
tempSelectedColors.splice(index, 1);
} else {
tempSelectedColors.push({ nome, hex });
}
renderColorPickerPalette();
renderSelectedColors();
}
function getAparelhoFavorites() { return JSON.parse(safeStorage.getItem(APARELHO_FAVORITES_KEY) || '{}'); }
function saveAparelhoFavorites(favorites) { safeStorage.setItem(APARELHO_FAVORITES_KEY, JSON.stringify(favorites)); }
function renderAparelhoFavorites() {
const container = document.getElementById('aparelhoFavoritosContainer');
if (!container) return;
const favorites = getAparelhoFavorites();
const favoriteNames = Object.keys(favorites);
if (favoriteNames.length === 0) { container.innerHTML = ''; return; }
container.innerHTML = favoriteNames.map(name => `
<div class="favorito">
<button class="favorito-btn" data-name="${escapeHtml(name)}">${escapeHtml(name)}</button>
<span class="remove-favorito-btn" data-name="${escapeHtml(name)}">🗑️</span>
</div>
`).join('');
}
function applyAparelhoFavorite(name) {
const favorites = getAparelhoFavorites();
const favData = favorites[name];
if (!favData) return;
const product = products.find(p => p.nome === favData.productName);
if (!product) { showCustomModal({ message: `Produto "${favData.productName}" não encontrado.` }); return; }
handleProductSelectionForAparelho(product);
document.getElementById('entradaAparelho').value = favData.entryValue || '';
document.getElementById('valorExtraAparelho').value = favData.additionalValue || '';
const toggleBtn = document.getElementById('toggleValorExtraBtn');
const extraContainer = document.getElementById('valorExtraContainer');
if (favData.additionalValue > 0) {
toggleBtn.classList.add('is-active');
extraContainer.classList.add('is-active');
} else {
toggleBtn.classList.remove('is-active');
extraContainer.classList.remove('is-active');
}
calculateAparelho();
}
function removeAparelhoFavorite(name) {
const favorites = getAparelhoFavorites();
delete favorites[name];
saveAparelhoFavorites(favorites);
renderAparelhoFavorites();
}
function setupPWA() {
const manifestData = document.getElementById('manifest-data').textContent;
const manifestBlob = new Blob([manifestData], {type: 'application/json'});
const manifestURL = URL.createObjectURL(manifestBlob);
document.querySelector('link[rel="manifest"]').setAttribute('href', manifestURL);
if ('serviceWorker' in navigator) {
const swScript = document.getElementById('sw-script').textContent;
const swBlob = new Blob([swScript], {type: 'text/javascript'});
const swURL = URL.createObjectURL(swBlob);
navigator.serviceWorker.register(swURL).then(reg => console.log('Service Worker registrado:', reg)).catch(err => console.log('Falha no registro do SW:', err));
}
}
function formatCurrency(value) {
return value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
function calculateContractPayments() {
const total = parseFloat(document.getElementById('valorTotal').value) || 0;
const entrada = parseFloat(document.getElementById('valorEntrada').value) || 0;
const parcelas = parseInt(document.getElementById('numeroParcelas').value, 10) || 0;
const saldo = total - entrada;
document.getElementById('saldoRestante').value = saldo > 0 ? formatCurrency(saldo) : '0,00';
if (parcelas > 0 && saldo > 0) {
const valorParcela = saldo / parcelas;
document.getElementById('valorParcela').value = formatCurrency(valorParcela);
} else {
document.getElementById('valorParcela').value = '0,00';
}
}
function numeroPorExtenso(numero, tipo = 'normal') {
const unidades = ["", "um", "dois", "três", "quatro", "cinco", "seis", "sete", "oito", "nove"];
const especiais = ["dez", "onze", "doze", "treze", "catorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove"];
const dezenas = ["", "", "vinte", "trinta", "quarenta", "cinquenta", "sessenta", "setenta", "oitenta", "noventa"];
const centenas = ["", "cento", "duzentos", "trezentos", "quatrocentos", "quinhentos", "seiscentos", "setecentos", "oitocentos", "novecentos"];
const converterGrupo = (n) => {
if (n === 0) return "";
if (n === 100) return "cem";
if (n < 0) return "";
let str = "";
let c = Math.floor(n / 100);
let d = Math.floor((n % 100) / 10);
let u = n % 10;
if (c > 0) {
str += centenas[c];
if (n % 100 !== 0) str += " e ";
}
if (d === 1) {
str += especiais[u];
} else {
if (d > 1) {
str += dezenas[d];
if (u > 0) str += " e ";
}
if (u > 0) {
str += unidades[u];
}
}
return str;
};
if (tipo === 'moeda') {
const valor = parseFloat(numero) || 0;
if (valor === 0) return "zero reais";
const parteInteira = Math.floor(valor);
const parteDecimal = Math.round((valor - parteInteira) * 100);
let strInteira = "";
if (parteInteira > 0) {
const mil = Math.floor(parteInteira / 1000);
const resto = parteInteira % 1000;
if (mil > 0) {
strInteira += (mil === 1 ? "mil" : converterGrupo(mil) + " mil");
if (resto > 0) strInteira += (resto < 100 || resto % 100 === 0 ? " e " : " ");
}
if (resto > 0) {
strInteira += converterGrupo(resto);
}
strInteira += (parteInteira === 1 ? " real" : " reais");
}
let strDecimal = "";
if (parteDecimal > 0) {
strDecimal += converterGrupo(parteDecimal);
strDecimal += (parteDecimal === 1 ? " centavo" : " centavos");
}
if (strInteira && strDecimal) return strInteira + " e " + strDecimal;
return strInteira || strDecimal || "zero reais";
} else {
if (numero === 0) return "zero";
return converterGrupo(numero);
}
}
function saveContractDraft() {
const draftStatus = document.getElementById('draftStatus');
const formData = {};
document.querySelectorAll('#contractForm input, #contractForm select').forEach(input => {
if(input.id) {
formData[input.id] = input.value;
}
});
safeStorage.setItem(CONTRACT_DRAFT_KEY, JSON.stringify(formData));
if (draftStatus) {
draftStatus.textContent = 'Rascunho salvo!';
clearTimeout(draftSaveTimeout);
draftSaveTimeout = setTimeout(() => {
draftStatus.textContent = '';
}, 2000);
}
}
function loadContractDraft() {
const savedDraft = safeStorage.getItem(CONTRACT_DRAFT_KEY);
if (savedDraft) {
const formData = JSON.parse(savedDraft);
for (const key in formData) {
const input = document.getElementById(key);
if (input) {
input.value = formData[key];
}
}
calculateContractPayments();
showCustomModal({ message: 'Rascunho anterior carregado.'});
}
}
function clearContractDraft(clearStorage = true) {
document.getElementById('contractForm').reset();
calculateContractPayments();
if(clearStorage) {
safeStorage.removeItem(CONTRACT_DRAFT_KEY);
showCustomModal({ message: 'Rascunho apagado.'});
}
}
function populatePreview() {
document.getElementById('contractPreview').innerHTML = `
<h4>CONTRATO DE COMPRA E VENDA DE SMARTPHONE</h4>
<p>Pelo presente instrumento particular, as partes a seguir identificadas firmam o presente CONTRATO DE COMPRA E VENDA, mediante as cláusulas e condições abaixo:</p>
<div class="section-title" style="text-transform: none; text-align: left;">VENDEDOR</div>
<p>Workcell Tecnologia LTDA – CNPJ nº 50.299.715/0001-65, com sede em Av. Goiás, n° 4118 - loja 05 posto - St. Crimeia Oeste, Goiânia - GO, 74563-220.</p>
<div class="section-title" style="text-transform: none; text-align: left;">COMPRADOR</div>
<p style="margin-bottom: 24pt;">
Nome: <span id="previewNome"></span><br>
CPF: <span id="previewCpf"></span> RG: <span id="previewRg"></span><br>
Endereço: <span id="previewEndereco"></span>
</p>
<div class="section-title">CLÁUSULA 1 – DO OBJETO</div>
<p>O presente contrato tem por objeto a venda do(s) smartphone(s) descrito(s) abaixo:</p>
<p style="margin-bottom: 24pt;">
Modelo: <span id="previewModelo"></span><br>
IMEI(s): <span id="previewImei"></span><br>
Valor total: R$ <span id="previewValorTotal"></span>
</p>
<div class="section-title">CLÁUSULA 2 – DO PAGAMENTO</div>
<p>2.1 O valor total da compra é de R$ <span id="previewValorTotal2"></span> (<span id="previewValorExtenso"></span>), sendo pago da seguinte forma:</p>
<p id="clausulaPagamentoB"></p>
<p style="margin-bottom: 24pt;">
2.2 O não pagamento de qualquer parcela na data de vencimento acarretará:<br>
Multa de 2% (dois por cento) sobre o valor da parcela em atraso;<br>
Juros de mora de 1% (um por cento) ao mês;<br>
Correção monetária conforme índice legal aplicável.
</p>
<div class="section-title">CLÁUSULA 3 – DA PROPRIEDADE</div>
<p>3.1 A propriedade do smartphone somente será transferida ao COMPRADOR após a quitação integral de todas as parcelas.</p>
<p>3.2 Em caso de inadimplência, o COMPRADOR será notificado pelo VENDEDOR e terá o prazo de 5 (cinco) dias corridos para regularizar o pagamento.</p>
<p style="margin-bottom: 24pt;">3.3 Caso não haja a regularização no prazo informado, o VENDEDOR poderá proceder ao bloqueio remoto do aparelho, impedindo seu uso até a quitação ou negociação da dívida, sem prejuízo da cobrança das parcelas vencidas e demais encargos previstos neste contrato.</p>
<div class="section-title">CLÁUSULA 4 – DAS GARANTIAS</div>
<p>4.1 O aparelho possui garantia legal de 1 (um) ano para qualquer defeito de fabricação pelo fabricante, contados a partir da entrega do produto.</p>
<p style="margin-bottom: 24pt;">4.2 A garantia não cobre mau uso, quedas, molhar, oxidação ou violação do aparelho.</p>
<div class="section-title">CLÁUSULA 5 – DA RESCISÃO</div>
<p style="margin-bottom: 24pt;">5.1 O não cumprimento de qualquer obrigação contratual poderá resultar na rescisão imediata deste contrato, com a cobrança das parcelas vencidas e vincendas, além das penalidades cabíveis.</p>
<div class="section-title">CLÁUSULA 6 – DO FORO</div>
<p>As partes elegem o foro da comarca de Goiânia para dirimir quaisquer dúvidas oriundas deste contrato.</p>
<p style="margin-top: 24pt;">E por estarem de acordo, firmam o presente contrato em 2 (duas) vias de igual teor.</p>
<p style="margin-top: 40pt;">Local e data: <span id="previewLocalData"></span></p>
<div style="text-align: center; margin-top: 40pt;">
<div class="signature-line" style="margin-bottom: 5px;"></div>
<p style="margin-bottom: 5pt; margin-top:0;">Assinatura VENDEDOR</p>
</div>
<div style="text-align: center; margin-top: 20pt;">
<div class="signature-line" style="margin-bottom: 5px;"></div>
<p style="margin-bottom: 5pt; margin-top:0;">Assinatura COMPRADOR</p>
</div>
`;
document.getElementById('previewNome').textContent = document.getElementById('compradorNome').value;
document.getElementById('previewCpf').textContent = document.getElementById('compradorCpf').value;
document.getElementById('previewRg').textContent = document.getElementById('compradorRg').value;
document.getElementById('previewEndereco').textContent = document.getElementById('compradorEndereco').value;
document.getElementById('previewModelo').textContent = document.getElementById('produtoModelo').value;
document.getElementById('previewImei').textContent = document.getElementById('produtoImei').value;
const total = parseFloat(document.getElementById('valorTotal').value) || 0;
document.getElementById('previewValorTotal').textContent = formatCurrency(total);
document.getElementById('previewValorTotal2').textContent = formatCurrency(total);
document.getElementById('previewValorExtenso').textContent = numeroPorExtenso(total, 'moeda');
const entrada = parseFloat(document.getElementById('valorEntrada').value) || 0;
const numParcelas = parseInt(document.getElementById('numeroParcelas').value, 10) || 0;
const tipoParcela = document.getElementById('tipoParcela').value;
const primeiroVencimento = document.getElementById('primeiroVencimento').value;
const saldo = total - entrada;
const valorParcela = numParcelas > 0 ? saldo / numParcelas : 0;
let textoClausulaB = `a) Entrada no valor de R$ ${formatCurrency(entrada)}, paga no ato da assinatura deste contrato;<br>
b) O saldo restante de R$ ${formatCurrency(saldo)}, dividido em ${numeroPorExtenso(numParcelas)} (${numParcelas}) parcelas ${tipoParcela} de R$ ${formatCurrency(valorParcela)}, a serem pagas através de boleto bancário emitido pelo VENDEDOR`;
if (primeiroVencimento) {
const [ano, mes, dia] = primeiroVencimento.split('-');
const dataFormatada = `${dia}/${mes}/${ano}`;
textoClausulaB += `, com o primeiro vencimento em ${dataFormatada}.`;
} else {
textoClausulaB += '.';
}
document.getElementById('clausulaPagamentoB').innerHTML = textoClausulaB;
const today = new Date();
const dateOptions = { day: '2-digit', month: 'long', year: 'numeric' };
document.getElementById('previewLocalData').textContent = `Goiânia, ${today.toLocaleDateString('pt-BR', dateOptions)}`;
}
function loadBoletosHistory() {
if (!db || !isAuthReady) return;
const boletosRef = ref(db, 'boletos');
const historyContainer = document.getElementById('historyBoletoContent');
historyContainer.innerHTML = '<div class="text-center p-4"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Carregando...</span></div></div>';
if (boletosListener) off(boletosRef, 'value', boletosListener);
boletosListener = onValue(boletosRef, (snapshot) => {
if (snapshot.exists()) {
const data = snapshot.val();
renderBoletosHistory(data);
} else {
historyContainer.innerHTML = `<div class="text-center p-5">
<i class="bi bi-journal-x" style="font-size: 4rem; color: var(--text-secondary);"></i>
<h5 class="mt-3">Nenhum formulário no histórico</h5>
<p class="text-secondary">Crie um novo formulário para vê-lo aqui.</p>
</div>`;
}
}, (error) => {
console.error("Firebase Read Error (Boletos):", error);
historyContainer.innerHTML = `<div class="alert alert-danger">Erro ao carregar o histórico.</div>`;
});
}
function renderBoletosHistory(data) {
const historyContainer = document.getElementById('historyBoletoContent');
const boletosArray = Object.keys(data).map(key => ({ id: key, ...data[key] }));
boletosArray.sort((a, b) => new Date(b.criadoEm) - new Date(a.criadoEm));
if (boletosArray.length === 0) {
historyContainer.innerHTML = `<div class="text-center p-5">...</div>`;
return;
}
historyContainer.innerHTML = `<div class="accordion w-100 history-accordion" id="boletosAccordion">${boletosArray.map(boleto => {
const telefoneLimpo = boleto.compradorTelefone ? boleto.compradorTelefone.replace(/\D/g, '') : '';
const whatsappLink = telefoneLimpo ? `https://wa.me/55${telefoneLimpo}` : '';
const telefoneHtml = whatsappLink ? `<a href="${whatsappLink}" target="_blank" class="btn btn-sm btn-success"><i class="bi bi-whatsapp"></i> ${escapeHtml(boleto.compradorTelefone)}</a>` : '(Não informado)';
return `
<div class="accordion-item">
<h2 class="accordion-header" id="heading-${boleto.id}">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${boleto.id}" aria-expanded="false" aria-controls="collapse-${boleto.id}">
${escapeHtml(boleto.compradorNome)} - ${new Date(boleto.criadoEm).toLocaleDateString('pt-BR')}
</button>
</h2>
<div id="collapse-${boleto.id}" class="accordion-collapse collapse" aria-labelledby="heading-${boleto.id}" data-bs-parent="#boletosAccordion">
<div class="accordion-body">
<p><strong>Comprador:</strong> ${escapeHtml(boleto.compradorNome)}<br>
<strong>CPF:</strong> ${escapeHtml(boleto.compradorCpf)}<br>
<strong>Telefone:</strong> ${telefoneHtml}</p>
<p><strong>Produto:</strong> ${escapeHtml(boleto.produtoModelo)}<br>
<strong>IMEI:</strong> ${escapeHtml(boleto.produtoImei)}</p>
<p><strong>Valor Total:</strong> R$ ${escapeHtml(boleto.valorTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2}))}<br>
<strong>Entrada:</strong> R$ ${escapeHtml(boleto.valorEntrada.toLocaleString('pt-BR', {minimumFractionDigits: 2}))}<br>
<strong>Parcelas:</strong> ${boleto.numeroParcelas}x de R$ ${boleto.valorParcela}</p>
<hr style="border-color: var(--glass-border);">
<div class="text-end">
<button class="btn btn-sm btn-outline-danger delete-boleto-btn" data-id="${boleto.id}"><i class="bi bi-trash"></i> Excluir</button>
</div>
</div>
</div>
</div>`
}).join('')}</div>`;
historyContainer.querySelectorAll('.delete-boleto-btn').forEach(btn => {
btn.addEventListener('click', (e) => {
const boletoId = e.currentTarget.dataset.id;
showCustomModal({
message: "Tem certeza que deseja excluir este registro do histórico? Esta ação não pode ser desfeita.",
confirmText: "Sim, Excluir",
onConfirm: async () => {
try {
await remove(ref(db, `boletos/${boletoId}`));
showCustomModal({ message: "Registro excluído com sucesso." });
} catch (error) {
showCustomModal({ message: `Erro ao excluir: ${error.message}` });
}
},
onCancel: () => {}
});
});
});
}
function checkForDueInstallments() {
if (!db || !isAuthReady) return;
const boletosRef = ref(db, 'boletos');
const todayStr = new Date().toISOString().split('T')[0];
const viewedNotifsKey = `viewedNotifications_${todayStr}`;
Object.keys(localStorage).forEach(key => {
if (key.startsWith('viewedNotifications_') && key !== viewedNotifsKey) {
safeStorage.removeItem(key);
}
});
if (notificationsListener) off(boletosRef, 'value', notificationsListener);
notificationsListener = onValue(boletosRef, (snapshot) => {
const viewedNotifs = JSON.parse(safeStorage.getItem(viewedNotifsKey) || '[]');
const notifications = [];
if (snapshot.exists()) {
const data = snapshot.val();
const today = new Date();
today.setHours(0, 0, 0, 0);
for (const key in data) {
const boleto = data[key];
const baseDate = boleto.primeiroVencimento ? new Date(boleto.primeiroVencimento + 'T00:00:00') : new Date(boleto.criadoEm);
for (let i = 0; i < boleto.numeroParcelas; i++) {
let dueDate;
if(boleto.primeiroVencimento) {
dueDate = new Date(baseDate);
if (boleto.tipoParcela === 'mensais') {
dueDate.setMonth(baseDate.getMonth() + i);
} else {
dueDate.setDate(baseDate.getDate() + (i * 7));
}
} else {
dueDate = new Date(baseDate);
if (boleto.tipoParcela === 'mensais') {
dueDate.setMonth(baseDate.getMonth() + i + 1);
} else {
dueDate.setDate(baseDate.getDate() + ((i + 1) * 7));
}
}
dueDate.setHours(0, 0, 0, 0);
if (dueDate.getTime() === today.getTime()) {
const notificationId = `${key}_${i}`;
if (!viewedNotifs.includes(notificationId)) {
notifications.push({
notificationId: notificationId,
boletoId: key,
message: `<strong>${escapeHtml(boleto.compradorNome)}:</strong> Parcela ${i + 1}/${boleto.numeroParcelas} vence hoje.`
});
}
}
}
}
}
updateNotificationUI(notifications);
});
}
function updateNotificationUI(notifications) {
const badge = document.querySelector('#notification-bell .notification-badge');
const notificationList = document.getElementById('notificationList');
if (notifications.length > 0) {
badge.textContent = notifications.length;
badge.classList.remove('hidden');
notificationList.innerHTML = notifications.map(notif =>
`<a href="#" class="list-group-item list-group-item-action notification-item" data-boleto-id="${notif.boletoId}" data-notification-id="${notif.notificationId}">${notif.message}</a>`
).join('');
} else {
badge.classList.add('hidden');
notificationList.innerHTML = '<div class="list-group-item text-center">Nenhuma notificação hoje.</div>';
}
}
const initialDefaultTags = ['Nenhuma', 'Chinês', 'Samsung / Apple', 'Seminovo Iphone', 'Seminovo android'];
function getTagList() { return tags; }
async function saveTagList(newTags) {
try {
await update(ref(db), { 'tags': newTags });
} catch (error) {
console.error("Erro ao salvar etiquetas:", error);
showCustomModal({ message: `Erro ao salvar etiquetas: ${error.message}`});
}
}
function loadTagTexts() {
const stored = safeStorage.getItem(TAG_TEXTS_KEY);
tagTexts = stored ? JSON.parse(stored) : {};
}
function populateTagSelects() {
const tags = getTagList();
const optionsHtml = tags.map(tag => `<option value="${escapeHtml(tag)}">${escapeHtml(tag)}</option>`).join('');
document.getElementById('newProductTag').innerHTML = optionsHtml;
document.getElementById('newProductTag').value = 'Nenhuma';
}
async function updateTagNameInProducts(oldTag, newTag) {
const updates = {};
products.forEach(product => {
if (product.tag === oldTag) {
updates[`/products/${product.id}/tag`] = newTag;
}
});
if (Object.keys(updates).length > 0) {
try {
await update(ref(db), updates);
showCustomModal({ message: `Etiqueta atualizada em ${Object.keys(updates).length} produto(s).`});
} catch(error) {
console.error("Erro ao atualizar etiquetas nos produtos:", error);
showCustomModal({ message: `Erro ao atualizar produtos: ${error.message}`});
}
}
}
function renderTagManagementUI() {
const container = document.getElementById('adminTagsContent');
if (!container) return;
const tags = getTagList();
let tagsHtml = tags.map(tag => {
if (tag === 'Nenhuma') return '';
const savedText = tagTexts[tag] || '';
return `
<div class="p-3 mb-2 rounded" style="background-color: rgba(0,0,0,0.2);">
<div class="mb-2">
<label class="form-label small">Nome da Etiqueta</label>
<input type="text" class="form-control form-control-sm tag-name-input" value="${escapeHtml(tag)}" data-original-name="${escapeHtml(tag)}">
</div>
<div class="mb-3">
<label class="form-label small">Texto Personalizado</label>
<textarea class="form-control form-control-sm tag-text-input" rows="3" placeholder="Texto para ${escapeHtml(tag)}">${escapeHtml(savedText)}</textarea>
</div>
<div class="text-end">
<button class="btn btn-sm btn-outline-danger delete-tag-btn" data-tag="${escapeHtml(tag)}"><i class="bi bi-trash"></i></button>
<button class="btn btn-sm btn-primary save-tag-btn" data-tag="${escapeHtml(tag)}"><i class="bi bi-save-fill"></i> Salvar</button>
</div>
</div>
`;
}).join('');
container.innerHTML = `
<div class="admin-section w-100">
<h4 class="text-start"><i class="bi bi-tags-fill"></i> Gerenciar Etiquetas e Textos</h4>
<p class="text-start text-secondary">Adicione, edite ou remova etiquetas e seus textos personalizados.</p>
<div class="p-3 mb-4 rounded" style="background-color: rgba(0,0,0,0.2);">
<form id="addTagForm">
<label class="form-label">Adicionar Nova Etiqueta</label>
<div class="d-flex gap-2">
<input type="text" class="form-control" id="newTagName" placeholder="Nome da nova etiqueta" required>
<button type="submit" class="btn btn-success"><i class="bi bi-plus-lg"></i> Adicionar</button>
</div>
</form>
</div>
<div id="tag-editor-list">
${tagsHtml}
</div>
</div>
`;
}
function loadTagsFromDB() {
if (!db || !isAuthReady) return;
const tagsRef = ref(db, 'tags');
if (tagsListener) off(tagsRef, 'value', tagsListener);
tagsListener = onValue(tagsRef, (snapshot) => {
if (snapshot.exists()) {
tags = snapshot.val();
if (!Array.isArray(tags) || !tags.includes('Nenhuma')) {
tags = [...initialDefaultTags];
update(ref(db), { 'tags': tags });
}
} else {
tags = [...initialDefaultTags];
update(ref(db), { 'tags': tags });
}
populateTagSelects();
if (document.getElementById('adminTagsContent') && !document.getElementById('adminTagsContent').classList.contains('hidden')) {
renderTagManagementUI();
}
}, (error) => {
console.error("Firebase Read Error (Tags):", error);
tags = [];
showCustomModal({ message: `Erro ao carregar etiquetas da nuvem. Verifique as permissões do Firebase.` });
});
}
async function main() {
try {
setupPWA();
applyTheme(safeStorage.getItem('theme') || 'dark');
app = initializeApp(firebaseConfig); auth = getAuth(app); db = getDatabase(app);
onAuthStateChanged(auth, async (user) => {
if (user) {
userId = user.uid;
isAuthReady = true;
loadRatesFromDB();
loadProductsFromDB();
loadTagsFromDB();
loadTagTexts();
checkForDueInstallments();
const loadingOverlay = document.getElementById('loadingOverlay');
loadingOverlay.style.opacity = '0';
setTimeout(() => {
loadingOverlay.style.display = 'none';
showMainSection('main');
}, 500);
}
else await signInAnonymously(auth);
});
} catch (error) { console.error("Firebase Init Error:", error); document.body.innerHTML = `<h1>Erro ao conectar.</h1><p>${error.message}</p>`; }
}
document.addEventListener('DOMContentLoaded', () => {
const notificationOffcanvasEl = document.getElementById('notificationPanel');
const notificationOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(notificationOffcanvasEl);
document.getElementById('notification-bell').addEventListener('click', () => notificationOffcanvas.toggle());
document.getElementById('notificationList').addEventListener('click', (e) => {
const item = e.target.closest('.notification-item');
if (item) {
e.preventDefault();
const boletoId = item.dataset.boletoId;
const notificationId = item.dataset.notificationId;
const todayStr = new Date().toISOString().split('T')[0];
const viewedNotifsKey = `viewedNotifications_${todayStr}`;
let viewedNotifs = JSON.parse(safeStorage.getItem(viewedNotifsKey) || '[]');
if (!viewedNotifs.includes(notificationId)) {
viewedNotifs.push(notificationId);
safeStorage.setItem(viewedNotifsKey, JSON.stringify(viewedNotifs));
}
item.remove();
const remainingItems = document.querySelectorAll('#notificationList .notification-item').length;
const badge = document.querySelector('#notification-bell .notification-badge');
if (remainingItems > 0) {
badge.textContent = remainingItems;
} else {
badge.classList.add('hidden');
document.getElementById('notificationList').innerHTML = '<div class="list-group-item text-center">Nenhuma notificação hoje.</div>';
}
showMainSection('contract');
setTimeout(() => {
const toggle = document.getElementById('boletoModeToggle');
if (!toggle.checked) {
toggle.checked = true;
toggle.dispatchEvent(new Event('change'));
}
setTimeout(() => {
const accordionButton = document.querySelector(`#heading-${boletoId} button`);
if (accordionButton) {
const collapseEl = document.getElementById(accordionButton.getAttribute('data-bs-target').substring(1));
const bsCollapse = bootstrap.Collapse.getOrCreateInstance(collapseEl, { toggle: false });
bsCollapse.show();
collapseEl.addEventListener('shown.bs.collapse', () => {
accordionButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
}, { once: true });
}
}, 300);
}, 100);
notificationOffcanvas.hide();
}
});
const savedTheme = safeStorage.getItem('theme') || 'dark';
applyTheme(savedTheme);
themeToggleCheckbox.addEventListener('change', toggleTheme);
document.getElementById('goToCalculator').addEventListener('click', () => showMainSection('calculator'));
document.getElementById('goToContract').addEventListener('click', () => showMainSection('contract'));
document.getElementById('goToStock').addEventListener('click', () => {
showCustomModal({
message: "Digite a senha para acessar o Estoque:",
showPassword: true,
confirmText: "Acessar",
onConfirm: (password) => {
if (password === "220390") {
showMainSection('stock');
} else {
showCustomModal({ message: "Senha incorreta." });
}
},
onCancel: () => {}
});
});
document.getElementById('goToAdmin').addEventListener('click', () => showMainSection('administracao'));
document.getElementById('backFromContract').addEventListener('click', () => showMainSection('main'));
document.getElementById('backFromStock').addEventListener('click', () => showMainSection('main'));
document.getElementById('backFromAdmin').addEventListener('click', () => showMainSection('main'));
document.getElementById('goToAdminFromEmptyState').addEventListener('click', () => showMainSection('administracao'));
['openFecharVenda', 'openRepassarValores', 'openCalcularEmprestimo', 'openCalcularPorAparelho'].forEach(id => { document.getElementById(id).addEventListener('click', () => openCalculatorSection(id.replace('open', '').charAt(0).toLowerCase() + id.slice(5))); });
['backFromFecharVenda', 'backFromRepassarValores', 'backFromCalcularEmprestimo', 'backFromCalcularPorAparelho'].forEach(id => { document.getElementById(id).addEventListener('click', () => openCalculatorSection('calculatorHome')); });
const installmentsSlider = document.getElementById('installments1');
const installmentsValueDisplay = document.getElementById('installments1Value');
installmentsSlider.addEventListener('input', () => {
const value = installmentsSlider.value;
installmentsValueDisplay.textContent = (value === '0') ? 'Débito' : `${value}x`;
updateFecharVendaUI();
});
document.getElementById('machine1').addEventListener('change', () => { updateInstallmentsOptions(); updateFecharVendaUI(); if(document.getElementById('machine1').value !== 'pagbank') openFlagModal(document.getElementById('machine1')); });
document.getElementById('brand1').addEventListener('change', updateFecharVendaUI);
document.getElementById('vendaModeToggle').addEventListener('change', updateFecharVendaUI);
document.querySelectorAll('input[name="manualMode"]').forEach(radio => radio.addEventListener('change', updateFecharVendaUI));
document.getElementById('vendaProdutoSearch').addEventListener('input', () => displayDynamicSearchResults(document.getElementById('vendaProdutoSearch').value, 'vendaSearchResultsContainer', handleProductSelectionForVenda));
document.getElementById('fecharVendaValue').addEventListener('input', calculateFecharVenda);
document.getElementById('resultFecharVenda').addEventListener('change', e => { if (e.target && e.target.id === 'descontarFoneCheckbox') calculateFecharVenda(); });
document.getElementById('entradaAVistaCheckbox').addEventListener('change', toggleEntradaAVistaUI);
document.getElementById('valorEntradaAVista').addEventListener('input', calculateFecharVenda);
document.getElementById('valorPassadoNoCartao').addEventListener('input', calculateFecharVenda);
document.getElementById('aparelhoSearch').addEventListener('input', () => {
    const searchTerm = document.getElementById('aparelhoSearch').value;
    if (currentlySelectedProductForCalc && searchTerm !== currentlySelectedProductForCalc.nome) {
        currentlySelectedProductForCalc = null;
    }
    displayDynamicSearchResults(searchTerm, 'aparelhoResultsContainer', handleProductSelectionForAparelho);
});
document.getElementById('entradaAparelho').addEventListener('input', calculateAparelho);
document.getElementById('valorExtraAparelho').addEventListener('input', calculateAparelho);
document.getElementById('toggleValorExtraBtn').addEventListener('click', (e) => {
const btn = e.currentTarget;
const container = document.getElementById('valorExtraContainer');
btn.classList.toggle('is-active');
container.classList.toggle('is-active');
});
document.getElementById('machine3').addEventListener('change', () => { updateCalcularPorAparelhoUI(); if(document.getElementById('machine3').value !== 'pagbank') openFlagModal(document.getElementById('machine3')); });
document.getElementById('brand3').addEventListener('change', updateCalcularPorAparelhoUI);
document.getElementById('aparelhoFavoritosContainer').addEventListener('click', e => {
const favoriteBtn = e.target.closest('.favorito-btn');
const removeBtn = e.target.closest('.remove-favorito-btn');
if (favoriteBtn) {
applyAparelhoFavorite(favoriteBtn.dataset.name);
} else if (removeBtn) {
removeAparelhoFavorite(removeBtn.dataset.name);
}
});
document.getElementById('resultCalcularPorAparelho').addEventListener('click', (e) => {
const row = e.target.closest('.copyable-row');
if (!row) return;
const installments = row.dataset.installments;
const parcelaValue = parseFloat(row.dataset.parcela);
const totalValue = parseFloat(row.dataset.total);
const produtoNome = currentlySelectedProductForCalc ? currentlySelectedProductForCalc.nome : (document.getElementById('aparelhoSearch').value.trim() || 'Produto');
const entradaValue = parseFloat(document.getElementById('entradaAparelho').value) || 0;
const parcelaFormatted = parcelaValue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
const totalFormatted = totalValue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
let entradaText = '';
if (entradaValue > 0) {
const entradaFormatted = entradaValue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
entradaText = `\n"+${entradaFormatted} no dinheiro ou pix"`;
}
let customText = '';
if (currentlySelectedProductForCalc && currentlySelectedProductForCalc.tag && currentlySelectedProductForCalc.tag !== 'Nenhuma' && tagTexts[currentlySelectedProductForCalc.tag]) {
customText = `\n\n${tagTexts[currentlySelectedProductForCalc.tag]}`;
}
const textToCopy = `${installments}x ${parcelaFormatted}\n_(Total: ${totalFormatted})_${entradaText}\n🔵 ${produtoNome}${customText}`;
const textArea = document.createElement("textarea");
textArea.value = textToCopy;
textArea.style.position = "fixed";
textArea.style.top = "0";
textArea.style.left = "0";
textArea.style.opacity = "0";
document.body.appendChild(textArea);
textArea.focus();
textArea.select();
try {
const successful = document.execCommand('copy');
if (successful) {
showCustomModal({ message: 'Simulação copiada!' });
} else {
showCustomModal({ message: 'Falha ao copiar.' });
}
} catch (err) {
console.error('Erro ao copiar:', err);
showCustomModal({ message: 'Erro ao copiar.' });
}
document.body.removeChild(textArea);
});
const favoriteNameModal = document.getElementById('favoriteNameModalOverlay');
const favoriteNameInput = document.getElementById('favoriteNameInput');
const confirmSaveFavoriteBtn = document.getElementById('confirmSaveFavoriteBtn');
const cancelSaveFavoriteBtn = document.getElementById('cancelSaveFavoriteBtn');
const closeFavoriteNameModal = () => favoriteNameModal.classList.remove('active');
document.getElementById('saveAparelhoFavoriteBtn').addEventListener('click', () => {
const favorites = getAparelhoFavorites();
if (Object.keys(favorites).length >= MAX_FAVORITES) {
showCustomModal({ message: `Você já tem ${MAX_FAVORITES} favoritos. Remova um para salvar outro.` });
return;
}
favoriteNameInput.value = '';
favoriteNameModal.classList.add('active');
favoriteNameInput.focus();
});
confirmSaveFavoriteBtn.addEventListener('click', () => {
const favoriteName = favoriteNameInput.value.trim();
const favorites = getAparelhoFavorites();
if (!favoriteName) {
showCustomModal({ message: "Por favor, digite um nome para o favorito." });
return;
}
if (favorites[favoriteName]) {
showCustomModal({ message: "Já existe um favorito com este nome." });
return;
}
const favoriteData = {
productName: document.getElementById('aparelhoSearch').value,
entryValue: parseFloat(document.getElementById('entradaAparelho').value) || 0,
additionalValue: parseFloat(document.getElementById('valorExtraAparelho').value) || 0
};
favorites[favoriteName] = favoriteData;
saveAparelhoFavorites(favorites);
renderAparelhoFavorites();
closeFavoriteNameModal();
});
cancelSaveFavoriteBtn.addEventListener('click', closeFavoriteNameModal);
favoriteNameModal.addEventListener('click', (e) => { if (e.target === favoriteNameModal) closeFavoriteNameModal(); });
document.getElementById('machine2').addEventListener('change', () => { updateRepassarValoresUI(); if(document.getElementById('machine2').value !== 'pagbank') openFlagModal(document.getElementById('machine2')); });
document.getElementById('brand2').addEventListener('change', updateRepassarValoresUI);
document.getElementById('repassarValue').addEventListener('input', calculateRepassarValores);
document.getElementById('emprestimoValue').addEventListener('input', calculateEmprestimo);
document.getElementById('machine4').addEventListener('change', () => { updateCalcularEmprestimoUI(); if(document.getElementById('machine4').value !== 'pagbank') openFlagModal(document.getElementById('machine4')); });
document.getElementById('brand4').addEventListener('change', updateCalcularEmprestimoUI);
const lucroModalOverlay = document.getElementById('lucroModalOverlay');
const lucroPercentInput = document.getElementById('lucroPercentInput');
const closeLucroModal = () => lucroModalOverlay.classList.remove('active');
document.getElementById('openLucroModalBtn').addEventListener('click', () => {
lucroPercentInput.value = emprestimoLucroPercentual;
lucroModalOverlay.classList.add('active');
lucroPercentInput.focus();
});
document.getElementById('saveLucroBtn').addEventListener('click', () => {
const newPercent = parseFloat(lucroPercentInput.value);
if (!isNaN(newPercent) && newPercent >= 0) {
emprestimoLucroPercentual = newPercent;
calculateEmprestimo();
closeLucroModal();
} else {
showCustomModal({ message: 'Por favor, insira um valor de lucro válido.' });
}
});
document.getElementById('cancelLucroBtn').addEventListener('click', closeLucroModal);
lucroModalOverlay.addEventListener('click', (e) => { if (e.target === lucroModalOverlay) closeLucroModal(); });
document.getElementById('adminSearchInput').addEventListener('input', filterAdminProducts);
document.getElementById('addProductForm').addEventListener('submit', async (e) => {
e.preventDefault();
const nome = document.getElementById('newProductName').value.trim();
const valorStr = document.getElementById('newProductValue').value;
const quantidade = parseInt(document.getElementById('newProductQuantity').value) || 1;
const coresStr = document.getElementById('newProductColors').value.trim();
const tag = document.getElementById('newProductTag').value;
if (!nome || !valorStr) {
showCustomModal({ message: "Nome e Valor são obrigatórios." });
return;
}
const valor = parseBrazilianCurrencyToFloat(valorStr);
if (isNaN(valor)) {
showCustomModal({ message: "Valor inválido." });
return;
}
const cores = coresStr.split(',')
.map(nomeCor => nomeCor.trim())
.filter(Boolean)
.map(nomeCor => {
const paletaCor = colorPalette.find(p => p.nome.toLowerCase() === nomeCor.toLowerCase());
return paletaCor || { nome: nomeCor, hex: '#cccccc' };
});
const newProduct = { nome, valor, quantidade, cores, ignorarContagem: false, tag: tag };
try {
await push(getProductsRef(), newProduct);
showCustomModal({ message: `Produto "${nome}" adicionado com sucesso!`});
e.target.reset();
document.getElementById('newProductTag').value = 'Nenhuma';
} catch (error) {
showCustomModal({ message: `Erro ao adicionar produto: ${error.message}` });
}
});
document.getElementById('deleteAllProductsBtn').addEventListener('click', deleteAllProducts);
const productsListContainer = document.getElementById('productsListContainer');
productsListContainer.addEventListener('click', e => {
const deleteBtn = e.target.closest('.delete-product-btn');
if (deleteBtn) {
e.preventDefault();
const id = deleteBtn.dataset.id;
showCustomModal({ message: "Excluir este produto?", onConfirm: async () => await remove(ref(db, `products/${id}`)), onCancel: () => {} });
return;
}
});
productsListContainer.addEventListener('change', e => {
if (e.target.matches('.form-control, .form-select')) {
const card = e.target.closest('.admin-product-card');
if (card) {
const { field } = e.target.dataset;
const id = card.dataset.id;
let value;
if (field === 'valor') {
value = parseBrazilianCurrencyToFloat(e.target.value);
} else if (field === 'quantidade') {
value = parseInt(e.target.value, 10);
if (isNaN(value) || value < 0) value = 0;
} else {
value = e.target.value;
}
if (id && field && value !== undefined) {
updateProductInDB(id, { [field]: value });
}
}
}
if (e.target.matches('.ignore-toggle-switch-admin')) {
const id = e.target.dataset.id;
const isChecked = e.target.checked;
updateProductInDB(id, { ignorarContagem: isChecked });
}
});
document.getElementById('admin-nav-buttons').addEventListener('click', e => {
if (e.target.tagName === 'BUTTON') {
const targetId = e.target.dataset.adminSection;
document.getElementById('adminProductsContent').classList.add('hidden');
document.getElementById('adminRatesContent').classList.add('hidden');
document.getElementById('adminTagsContent').classList.add('hidden');
document.querySelectorAll('#admin-nav-buttons button').forEach(btn => btn.classList.remove('active'));
document.getElementById(targetId).classList.remove('hidden');
e.target.classList.add('active');
if (targetId === 'adminRatesContent') {
renderRatesEditor();
} else if (targetId === 'adminTagsContent') {
renderTagManagementUI();
}
}
});
document.getElementById('administracao').addEventListener('submit', e => {
if (e.target.id === 'addTagForm') {
e.preventDefault();
const input = document.getElementById('newTagName');
const newTag = input.value.trim();
if (newTag && newTag.toLowerCase() !== "nenhuma") {
const currentTags = getTagList();
if (!currentTags.find(t => t.toLowerCase() === newTag.toLowerCase())) {
saveTagList([...currentTags, newTag]);
input.value = '';
} else {
showCustomModal({ message: 'Essa etiqueta já existe.' });
}
}
}
});
document.getElementById('administracao').addEventListener('click', e => {
const deleteBtn = e.target.closest('.delete-tag-btn');
const saveBtn = e.target.closest('.save-tag-btn');
if (deleteBtn) {
const tagToDelete = deleteBtn.dataset.tag;
showCustomModal({
message: "Digite a senha de administrador para excluir.",
showPassword: true,
confirmText: "Confirmar",
onConfirm: (password) => {
if (password !== "220390") {
showCustomModal({ message: "Senha incorreta." });
return;
}
showCustomModal({
message: `Tem certeza que quer remover a etiqueta "${tagToDelete}"?`,
confirmText: 'Remover',
onConfirm: async () => {
let currentTags = getTagList();
currentTags = currentTags.filter(t => t !== tagToDelete);
await saveTagList(currentTags);
delete tagTexts[tagToDelete];
safeStorage.setItem(TAG_TEXTS_KEY, JSON.stringify(tagTexts));
},
onCancel: () => {}
});
},
onCancel: () => {}
});
}
if (saveBtn) {
const originalName = saveBtn.dataset.tag;
const container = saveBtn.closest('div.p-3');
const newNameInput = container.querySelector('.tag-name-input');
const newName = newNameInput.value.trim();
if(originalName !== newName) {
showCustomModal({
message: "Digite a senha de administrador para editar o nome.",
showPassword: true,
confirmText: "Confirmar",
onConfirm: (password) => {
if (password !== "220390") {
showCustomModal({ message: "Senha incorreta." });
newNameInput.value = originalName;
return;
}
saveTagChanges(originalName, container);
},
onCancel: () => {
newNameInput.value = originalName;
}
});
} else {
saveTagChanges(originalName, container);
}
}
});
async function saveTagChanges(originalName, container) {
const newName = container.querySelector('.tag-name-input').value.trim();
const newText = container.querySelector('.tag-text-input').value.trim();
if (!newName) {
showCustomModal({ message: 'O nome da etiqueta não pode ficar em branco.' });
return;
}
const currentTags = getTagList();
if (newName !== originalName && currentTags.find(t => t.toLowerCase() === newName.toLowerCase())) {
showCustomModal({ message: 'Já existe uma etiqueta com esse nome.' });
return;
}
const index = currentTags.indexOf(originalName);
if (index > -1) {
currentTags[index] = newName;
}
delete tagTexts[originalName];
tagTexts[newName] = newText;
await saveTagList(currentTags);
safeStorage.setItem(TAG_TEXTS_KEY, JSON.stringify(tagTexts));
if (originalName !== newName) {
await updateTagNameInProducts(originalName, newName);
} else {
showCustomModal({ message: 'Etiqueta salva!' });
}
}
const flagModalOverlay = document.getElementById('flagSelectorModalOverlay');
document.getElementById('closeFlagModalBtn').addEventListener('click', closeFlagModal);
flagModalOverlay.addEventListener('click', (e) => { if (e.target === flagModalOverlay) closeFlagModal(); });
['flagDisplayButton1', 'flagDisplayButton2', 'flagDisplayButton3', 'flagDisplayButton4'].forEach(id => { document.getElementById(id).addEventListener('click', (e) => { const sectionNumber = id.replace('flagDisplayButton', ''); openFlagModal(document.getElementById(`machine${sectionNumber}`)); }); });
document.addEventListener('click', (e) => { document.querySelectorAll('.search-wrapper').forEach(wrapper => { if (!wrapper.contains(e.target)) { const resultsContainer = wrapper.querySelector('.search-results-container'); if (resultsContainer) resultsContainer.innerHTML = ''; } }); });
document.getElementById('stockSearchInput').addEventListener('input', filterStockProducts);
document.getElementById('generateReportBtn').addEventListener('click', generateStockReport);
document.getElementById('toggleIgnoredBtn').addEventListener('click', (e) => {
onlyShowIgnored = !onlyShowIgnored;
const btn = e.currentTarget;
const icon = btn.querySelector('i');
document.getElementById('stockSearchInput').value = '';
if (onlyShowIgnored) {
btn.title = "Mostrar produtos visíveis";
icon.className = 'bi bi-eye-fill';
btn.classList.add('active');
} else {
btn.title = "Mostrar produtos ignorados";
icon.className = 'bi bi-eye-slash-fill';
btn.classList.remove('active');
}
filterStockProducts();
});
document.getElementById('resetCountBtn').addEventListener('click', () => {
showCustomModal({
message: "Tem certeza que deseja resetar o status de todos os itens para 'não conferido'?",
confirmText: "Sim, Resetar",
onConfirm: () => {
checkedItems = {};
saveCheckedItems();
filterStockProducts();
},
onCancel: () => {}
});
});
const stockTableBody = document.getElementById('stockTableBody');
const handleStockUpdate = (inputElement) => {
const card = inputElement.closest('.stock-item-card');
if (!card) return;
const id = card.dataset.id;
const product = products.find(p => p.id === id);
if (!product) return;
const oldValue = product.quantidade || 0;
let newValue = parseInt(inputElement.value, 10);
if (isNaN(newValue) || newValue < 0) {
newValue = 0;
inputElement.value = 0;
}
if (oldValue !== newValue) {
updateProductInDB(id, { quantidade: newValue });
modificationTracker[id] = { ...modificationTracker[id], quantity: true };
}
};
if(stockTableBody) {
stockTableBody.addEventListener('change', e => {
if (e.target.classList.contains('stock-qty-input')) {
handleStockUpdate(e.target);
}
if (e.target.classList.contains('stock-checked-toggle')) {
const id = e.target.dataset.id;
const isChecked = e.target.checked;
if (isChecked) {
const timestamp = Date.now();
checkedItems[id] = { checked: true, timestamp: timestamp };
updateProductInDB(id, { lastCheckedTimestamp: timestamp });
} else {
delete checkedItems[id];
updateProductInDB(id, { lastCheckedTimestamp: null });
}
saveCheckedItems();
delete modificationTracker[id];
filterStockProducts();
}
});
stockTableBody.addEventListener('click', e => {
const qtyButton = e.target.closest('.stock-qty-btn');
const colorButton = e.target.closest('.open-color-picker-btn');
const ignoreBtn = e.target.closest('.ignore-toggle-btn');
if (qtyButton) {
const change = parseInt(qtyButton.dataset.change, 10);
const input = qtyButton.parentElement.querySelector('.stock-qty-input');
if(!input) return;
let currentValue = parseInt(input.value, 10);
if (isNaN(currentValue)) currentValue = 0;
const newValue = Math.max(0, currentValue + change);
input.value = newValue;
handleStockUpdate(input);
}
if (colorButton) {
const id = colorButton.dataset.id;
openColorPicker(id);
}
if (ignoreBtn) {
const id = ignoreBtn.dataset.id;
const product = products.find(p => p.id === id);
if (product) {
const newIgnoredState = !product.ignorarContagem;
updateProductInDB(id, { ignorarContagem: newIgnoredState });
}
}
});
}
const colorPickerModal = document.getElementById('colorPickerModalOverlay');
document.getElementById('colorPalette').addEventListener('click', e => {
const swatch = e.target.closest('.color-swatch-lg');
if (swatch) {
toggleColorSelection(swatch.dataset.hex, swatch.dataset.nome);
}
});
document.getElementById('selectedColors').addEventListener('click', e => {
const removeBtn = e.target.closest('.remove-color-btn');
if(removeBtn) {
toggleColorSelection(removeBtn.dataset.hex);
}
});
document.getElementById('addCustomColorBtn').addEventListener('click', () => {
const nameInput = document.getElementById('customColorNameInput');
const hexInput = document.getElementById('customColorHexInput');
const nome = nameInput.value.trim();
const hex = hexInput.value;
if (nome) {
toggleColorSelection(hex, nome);
nameInput.value = '';
} else {
showCustomModal({message: "Por favor, digite um nome para a cor personalizada."});
}
});
document.getElementById('cancelColorPicker').addEventListener('click', () => colorPickerModal.classList.remove('active'));
document.getElementById('saveColorPicker').addEventListener('click', () => {
if (currentEditingProductId) {
const product = products.find(p => p.id === currentEditingProductId);
updateProductInDB(currentEditingProductId, { cores: tempSelectedColors });
modificationTracker[currentEditingProductId] = { ...modificationTracker[currentEditingProductId], color: true };
if (modificationTracker[currentEditingProductId]?.quantity) {
const timestamp = Date.now();
checkedItems[currentEditingProductId] = { checked: true, timestamp: timestamp };
saveCheckedItems();
updateProductInDB(currentEditingProductId, { lastCheckedTimestamp: timestamp });
delete modificationTracker[currentEditingProductId];
filterStockProducts();
}
}
colorPickerModal.classList.remove('active');
});
document.getElementById('boletoModeToggle').addEventListener('change', (e) => {
const showHistory = e.target.checked;
document.getElementById('newBoletoContent').classList.toggle('hidden', showHistory);
document.getElementById('historyBoletoContent').classList.toggle('hidden', !showHistory);
if (showHistory) {
loadBoletosHistory();
}
});
document.getElementById('contractForm').addEventListener('input', () => {
calculateContractPayments();
saveContractDraft();
});
document.getElementById('btnLimparCampos').addEventListener('click', () => clearContractDraft(true));
document.getElementById('btnApagarRascunho').addEventListener('click', () => {
safeStorage.removeItem(CONTRACT_DRAFT_KEY);
showCustomModal({ message: 'Rascunho apagado.' });
});
document.getElementById('btnImprimir').addEventListener('click', () => {
const contractForm = document.getElementById('contractForm');
if (!contractForm.checkValidity()) {
showCustomModal({ message: "Por favor, preencha todos os campos obrigatórios." });
contractForm.reportValidity();
return;
}
const boletosRef = ref(db, 'boletos');
const boletoData = {
compradorNome: document.getElementById('compradorNome').value,
compradorCpf: document.getElementById('compradorCpf').value,
compradorRg: document.getElementById('compradorRg').value,
compradorTelefone: document.getElementById('compradorTelefone').value,
compradorEndereco: document.getElementById('compradorEndereco').value,
produtoModelo: document.getElementById('produtoModelo').value,
produtoImei: document.getElementById('produtoImei').value,
valorTotal: parseFloat(document.getElementById('valorTotal').value) || 0,
valorEntrada: parseFloat(document.getElementById('valorEntrada').value) || 0,
saldoRestante: document.getElementById('saldoRestante').value,
numeroParcelas: parseInt(document.getElementById('numeroParcelas').value, 10) || 0,
valorParcela: document.getElementById('valorParcela').value,
tipoParcela: document.getElementById('tipoParcela').value,
primeiroVencimento: document.getElementById('primeiroVencimento').value,
criadoEm: new Date().toISOString()
};
push(boletosRef, boletoData)
.then(() => {
showCustomModal({ message: 'Contrato salvo no banco de dados!' });
populatePreview();
document.body.classList.add('print-only-contract');
window.print();
})
.catch((error) => {
console.error("Erro ao salvar contrato: ", error);
showCustomModal({ message: `Falha ao salvar o contrato: ${error.message}` });
});
});
document.getElementById('exportRepassarBtn').addEventListener('click', () => {
exportResultsToImage('resultRepassarValores', 'repassar-valores.png');
});
document.getElementById('exportEmprestimoBtn').addEventListener('click', () => {
const valorBase = parseFloat(document.getElementById('emprestimoValue').value) || 0;
if (valorBase <= 0) {
showCustomModal({ message: "Insira um valor base para exportar." });
return;
}
const header = `<h4 class="text-center mb-3" style="width: 100%; grid-column: 1 / -1;">Você Recebe na Hora: ${valorBase.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</h4>`;
exportResultsToImage('resultCalcularEmprestimo', 'calculo-emprestimo.png', header);
});
document.getElementById('exportAparelhoBtn').addEventListener('click', () => {
const aparelhoNome = document.getElementById('aparelhoSearch').value.trim();
if (!aparelhoNome) {
showCustomModal({ message: "Selecione um aparelho para exportar." });
return;
}
const header = `<h4 class="text-center mb-3" style="width: 100%; grid-column: 1 / -1;">${escapeHtml(aparelhoNome)}</h4>`;
const fileName = aparelhoNome.replace(/[^a-z0-9]/gi, '_').toLowerCase() || 'calculo-aparelho';
exportResultsToImage('resultCalcularPorAparelho', `${fileName}.png`, header);
});
window.addEventListener('afterprint', () => {
document.body.classList.remove('print-only-contract', 'print-only-report');
});
main();
document.addEventListener('backbutton', function (e) {
e.preventDefault();
const currentSection = document.querySelector('.container:not(.hidden):not([style*="display: none"])');
if (currentSection && currentSection.id !== 'mainMenu' && currentSection.id !== 'calculatorHome') {
showMainSection('main');
} else if (currentSection && currentSection.id === 'calculatorHome') {
showMainSection('main');
}
else {
if(navigator.app){
navigator.app.exitApp();
}
}
}, false);
window.addEventListener('popstate', function () {
const currentSection = document.querySelector('.container:not(.hidden):not([style*="display: none"])');
if (currentSection && currentSection.id !== 'mainMenu') {
showMainSection('main');
history.pushState(null, null, location.href);
}
});
history.pushState(null, null, location.href);
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
const DISABLED_MACHINES_KEY = 'disabledMachines';
function getDisabledMachines() {
try {
const disabled = localStorage.getItem(DISABLED_MACHINES_KEY);
return disabled ? JSON.parse(disabled) : [];
} catch (e) {
console.error('Erro ao ler as maquininhas desativadas do localStorage:', e);
return [];
}
}
function saveDisabledMachines(disabled) {
try {
localStorage.setItem(DISABLED_MACHINES_KEY, JSON.stringify(disabled));
} catch (e) {
console.error('Erro ao salvar as maquininhas desativadas no localStorage:', e);
}
}
function updateMachineVisibility() {
const disabledMachines = getDisabledMachines();
const selects = document.querySelectorAll('#machine1, #machine2, #machine3, #machine4');
selects.forEach(select => {
let isSelectedOptionHidden = false;
for (const option of select.options) {
const machineValue = option.value;
const shouldBeHidden = disabledMachines.includes(machineValue);
option.hidden = shouldBeHidden;
if (option.selected && shouldBeHidden) {
isSelectedOptionHidden = true;
}
}
if (isSelectedOptionHidden) {
const firstVisibleOption = select.querySelector('option:not([hidden])');
if (firstVisibleOption) {
select.value = firstVisibleOption.value;
select.dispatchEvent(new Event('change', { bubbles: true }));
}
}
});
}
function setupVisibilityToggles() {
const toggles = document.querySelectorAll('.visibility-toggle');
toggles.forEach(toggle => {
const machineName = toggle.dataset.machine;
const disabledMachines = getDisabledMachines();
toggle.checked = !disabledMachines.includes(machineName);
toggle.addEventListener('change', () => {
const currentDisabled = getDisabledMachines();
if (toggle.checked) {
const newDisabled = currentDisabled.filter(m => m !== machineName);
saveDisabledMachines(newDisabled);
} else {
if (!currentDisabled.includes(machineName)) {
currentDisabled.push(machineName);
saveDisabledMachines(currentDisabled);
}
}
updateMachineVisibility();
});
});
}
setupVisibilityToggles();
updateMachineVisibility();
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

